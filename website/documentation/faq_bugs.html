<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html>
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux (vers 25 March 2009), see www.w3.org">
  <!--#include virtual="/camcops/ssi/camcops_html_head.shtml" -->

  <title>CamCOPS – FAQs and known problems</title>
</head>

<body onload="generateTOC(document.getElementById('toc'));">
  <!--#set var="HEADER_TITLE" value="CamCOPS – FAQs and known problems" -->
  <!--#set var="HEADER_URL" value="documentation/faqs_bugs.html" -->
  <!--#set var="HEADER_BACK_URL" value="index.html" -->
  <!--#set var="HEADER_BACK_LABEL" value="Documentation" -->
  <!--#include virtual="/camcops/ssi/camcops_page_header.shtml" -->

  <div id="toc"></div>

  <h1>Common problems</h1>

  <h2>“Read timed out” error when uploading</h2>
  <p>If this happens frequently: Settings → Set privileged mode → Configure
  server settings → increase the <b>Network timeout (ms)</b> setting.</p>

  <h1>Known bugs</h1>

  <h2>Logo PNG with transparency crashes PDF generator</h2>
  <p><b>Problem:</b> If your institutional logo PNG file contains a
  transparency layer, it will crash the
  <a href="https://pypi.python.org/pypi/xhtml2pdf">xhtml2pdf</a> PDF generator
  (as of 2015-02-05). The error looks like:</p>
  <pre class="code1">
 /usr/local/lib/python2.7/dist-packages/xhtml2pdf/xhtml2pdf_reportlab.py in getRGBData...
    426                     self.mode = 'RGB'
    427                 elif mode not in ('L', 'RGB', 'CMYK'):
=&gt;  428                     im = im.convert('RGB')
    429                     self.mode = 'RGB'
    430                 self._data = im.tostring()
im = &lt;PIL.PngImagePlugin.PngImageFile image mode=P size=590x118&gt;, im.convert = &lt;bound method PngImageFile.convert of &lt;PIL.PngImagePlugin.PngImageFile image mode=P size=590x118&gt;&gt;

 /usr/local/lib/python2.7/dist-packages/PIL/Image.py in convert(self=&lt;PIL.PngImagePlugin.PngImageFile image mode=P size=590x118&gt;, mode='RGB', matrix=None, dither=3, palette=0, colors=256)
    808         if delete_trns:
    809             #crash fail if we leave a bytes transparency in an rgb/l mode.
=&gt;  810             del(new.info['transparency'])
    811         if trns is not None:
    812             if new_im.mode == 'P':
global new = &lt;function new&gt;, new.info undefined

&lt;type 'exceptions.UnboundLocalError'&gt;: local variable 'new' referenced before assignment
      args = ("local variable 'new' referenced before assignment",)
      message = "local variable 'new' referenced before assignment"
  </pre>
  <p><b>Solution 1:</b> remove the transparency layer. For example:</p>
  <ul>
    <li>Load the file in <a href="http://www.gimp.org/">GIMP</a>;</li>
    <li>Layer &rarr; Transparency &rarr; Remove alpha channel</li>
    <li>Resave, e.g. with File &rarr; Overwrite&hellip;</li>
  </ul>
  <p><b>Solution 2:</b> use a newer version of CamCOPS; from server version
  1.40, it uses <a href="http://wkhtmltopdf.org/">wkhtmltopdf</a> instead,
  which is also faster.</p>

  <h2>Uploading error: Operational error (1118). Row size too large (> 8126).
  Changing some columns to TEXT or BLOB may help. In current row format, BLOB
  prefix of 0 bytes is stored inline.</h2>
  <p>This is a problem with some TEXT-heavy tables, e.g.
  <b>psychiatricclerking</b>.</p>
  <p>Best thing: change the table format.</p>
  <ol>
    <li>
      Edit the MySQL config file, e.g. <code>/etc/my.cnf</code>. In the <code>[mysqld]</code> section, add the lines:
      <pre class="code1">innodb_file_per_table
innodb_file_format = Barracuda</pre>
    </li>
    <li>Restart MySQL.</li>
    <li>
      At the MySQL command line:
      <pre class="code1">ALTER TABLE <b>psychiatricclerking</b> ENGINE=InnoDB ROW_FORMAT=COMPRESSED KEY_BLOCK_SIZE=8;</pre>
    </li>
  </ol>
  <p>Another thing to consider for MySQL versions before 5.7.5: <b>making the MySQL log file
  bigger</b>, e.g. 512 Mb.</p>
  <ol>
    <li>At the MySQL console: <code>SET GLOBAL innodb_fast_shutdown=0;</code></li>
    <li>Stop MySQL.</li>
    <li>
      Edit the MySQL config file, e.g. <code>/etc/my.cnf</code>, and in the <code>[mysqld]</code> section, add the line:
      <pre class="code1">innodb_log_file_size = 512M</pre>
    </li>
    <li>Delete the old log files, e.g. <code>/var/lib/mysql/ib_logfile0</code> and
    <code>/var/lib/mysql/ib_logfile1</code>.</li>
    <li>Restart MySQL</li>
  </ol>
  <p><b>From CamCOPS v1.32,</b> the server autoconverts tables to Barracuda
  when using the make-tables command, to avoid this problem.</p>

  <p><i>Sources:</i></p>
  
  <ul>
    <i>
    <li><a href="http://stackoverflow.com/questions/25246074/row-size-too-large-8126-exception-on-adding-appcenter-application">http://stackoverflow.com/questions/25246074/row-size-too-large-8126-exception-on-adding-appcenter-application</a></li>
    <li><a href="http://stackoverflow.com/questions/22637733/mysql-error-code-1118-row-size-too-large-8126-changing-some-columns-to-te">http://stackoverflow.com/questions/22637733/mysql-error-code-1118-row-size-too-large-8126-changing-some-columns-to-te</a></li>
    <li><a href="http://serverfault.com/questions/104014/innodb-error-log-file-ib-logfile0-is-of-different-size">http://serverfault.com/questions/104014/innodb-error-log-file-ib-logfile0-is-of-different-size</a></li>
    <li><a href="http://stackoverflow.com/questions/15585602/change-limit-for-mysql-row-size-too-large">http://stackoverflow.com/questions/15585602/change-limit-for-mysql-row-size-too-large</a></li>
    <li><a href="http://dev.mysql.com/doc/relnotes/mysql/5.6/en/news-5-6-20.html">http://dev.mysql.com/doc/relnotes/mysql/5.6/en/news-5-6-20.html</a></li>
    <li><a href="http://dba.stackexchange.com/questions/14246/innodb-file-format-barracuda">http://dba.stackexchange.com/questions/14246/innodb-file-format-barracuda</a></li>
    </i>
  </ul>

  <!--#include virtual="/camcops/ssi/camcops_footer.shtml" -->
</body>
</html>
