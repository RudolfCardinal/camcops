
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>camcops_server.cc_modules.cc_forms &#8212; CamCOPS 2.2.4 documentation</title>
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/camcops_docs.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CamCOPS 2.2.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for camcops_server.cc_modules.cc_forms</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># camcops_server/cc_modules/cc_forms.py</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">===============================================================================</span>

<span class="sd">    Copyright (C) 2012-2018 Rudolf Cardinal (rudolf@pobox.com).</span>

<span class="sd">    This file is part of CamCOPS.</span>

<span class="sd">    CamCOPS is free software: you can redistribute it and/or modify</span>
<span class="sd">    it under the terms of the GNU General Public License as published by</span>
<span class="sd">    the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">    (at your option) any later version.</span>

<span class="sd">    CamCOPS is distributed in the hope that it will be useful,</span>
<span class="sd">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="sd">    GNU General Public License for more details.</span>

<span class="sd">    You should have received a copy of the GNU General Public License</span>
<span class="sd">    along with CamCOPS. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">===============================================================================</span>

<span class="sd">COLANDER NODES, NULLS, AND VALIDATION</span>

<span class="sd">- Surprisingly tricky.</span>
<span class="sd">- Nodes must be validly intialized with NO USER-DEFINED PARAMETERS to __init__;</span>
<span class="sd">  the Deform framework clones them.</span>
<span class="sd">- A null appstruct is used to initialize nodes as Forms are created.</span>
<span class="sd">  Therefore, the &quot;default&quot; value must be acceptable to the underlying type&#39;s</span>
<span class="sd">  serialize() function. Note in particular that &quot;default = None&quot; is not</span>
<span class="sd">  acceptable to Integer. Having no default is fine, though.</span>
<span class="sd">- In general, flexible inheritance is very hard to implement.</span>

<span class="sd">- Note that this error:</span>

<span class="sd">  .. code-block:: none</span>

<span class="sd">    AttributeError: &#39;EditTaskFilterSchema&#39; object has no attribute &#39;typ&#39;</span>

<span class="sd">  means you have failed to call super().__init__() properly from __init__().</span>

<span class="sd">- When creating a schema, its members seem to have to be created in the class</span>
<span class="sd">  declaration as class properties, not in __init__().</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="k">import</span> <span class="n">pformat</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="p">(</span><span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span>
                    <span class="n">Tuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">unittest</span>

<span class="kn">from</span> <span class="nn">cardinal_pythonlib.colander_utils</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">AllowNoneType</span><span class="p">,</span>
    <span class="n">BooleanNode</span><span class="p">,</span>
    <span class="n">DateSelectorNode</span><span class="p">,</span>
    <span class="n">DateTimeSelectorNode</span><span class="p">,</span>
    <span class="n">EmailValidatorWithLengthConstraint</span><span class="p">,</span>
    <span class="n">get_values_and_permissible</span><span class="p">,</span>
    <span class="n">HiddenIntegerNode</span><span class="p">,</span>
    <span class="n">HiddenStringNode</span><span class="p">,</span>
    <span class="n">MandatoryStringNode</span><span class="p">,</span>
    <span class="n">OptionalIntNode</span><span class="p">,</span>
    <span class="n">OptionalPendulumNode</span><span class="p">,</span>
    <span class="n">OptionalStringNode</span><span class="p">,</span>
    <span class="n">ValidateDangerousOperationNode</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">cardinal_pythonlib.deform_utils</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">DynamicDescriptionsForm</span><span class="p">,</span>
    <span class="n">InformativeForm</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">cardinal_pythonlib.logs</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">BraceStyleAdapter</span><span class="p">,</span>
    <span class="n">main_only_quicksetup_rootlogger</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">cardinal_pythonlib.sqlalchemy.dialect</span> <span class="k">import</span> <span class="n">SqlaDialectName</span>
<span class="kn">from</span> <span class="nn">cardinal_pythonlib.sqlalchemy.orm_query</span> <span class="k">import</span> <span class="n">CountStarSpecializedQuery</span>
<span class="kn">import</span> <span class="nn">colander</span>
<span class="kn">from</span> <span class="nn">colander</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">Boolean</span><span class="p">,</span>
    <span class="n">Date</span><span class="p">,</span>
    <span class="n">Integer</span><span class="p">,</span>
    <span class="n">Invalid</span><span class="p">,</span>
    <span class="n">Length</span><span class="p">,</span>
    <span class="n">MappingSchema</span><span class="p">,</span>
    <span class="n">OneOf</span><span class="p">,</span>
    <span class="n">Range</span><span class="p">,</span>
    <span class="n">Schema</span><span class="p">,</span>
    <span class="n">SchemaNode</span><span class="p">,</span>
    <span class="n">SchemaType</span><span class="p">,</span>
    <span class="n">SequenceSchema</span><span class="p">,</span>
    <span class="n">Set</span><span class="p">,</span>
    <span class="n">String</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">deform.form</span> <span class="k">import</span> <span class="n">Button</span>
<span class="kn">from</span> <span class="nn">deform.widget</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">CheckboxChoiceWidget</span><span class="p">,</span>
    <span class="n">CheckedPasswordWidget</span><span class="p">,</span>
    <span class="n">HiddenWidget</span><span class="p">,</span>
    <span class="n">MappingWidget</span><span class="p">,</span>
    <span class="n">PasswordWidget</span><span class="p">,</span>
    <span class="n">RadioChoiceWidget</span><span class="p">,</span>
    <span class="n">SelectWidget</span><span class="p">,</span>
    <span class="n">TextAreaWidget</span><span class="p">,</span>
    <span class="n">Widget</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># import as LITTLE AS POSSIBLE; this is used by lots of modules</span>
<span class="c1"># We use some delayed imports here (search for &quot;delayed import&quot;)</span>
<span class="kn">from</span> <span class="nn">.cc_constants</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">DEFAULT_ROWS_PER_PAGE</span><span class="p">,</span>
    <span class="n">MINIMUM_PASSWORD_LENGTH</span><span class="p">,</span>
    <span class="n">USER_NAME_FOR_SYSTEM</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.cc_group</span> <span class="k">import</span> <span class="n">Group</span>
<span class="kn">from</span> <span class="nn">.cc_idnumdef</span> <span class="k">import</span> <span class="n">IdNumDefinition</span>
<span class="kn">from</span> <span class="nn">.cc_patient</span> <span class="k">import</span> <span class="n">Patient</span>
<span class="kn">from</span> <span class="nn">.cc_patientidnum</span> <span class="k">import</span> <span class="n">PatientIdNum</span>
<span class="kn">from</span> <span class="nn">.cc_policy</span> <span class="k">import</span> <span class="n">TokenizedPolicy</span>
<span class="kn">from</span> <span class="nn">.cc_pyramid</span> <span class="k">import</span> <span class="n">FormAction</span><span class="p">,</span> <span class="n">ViewArg</span><span class="p">,</span> <span class="n">ViewParam</span>
<span class="kn">from</span> <span class="nn">.cc_sqla_coltypes</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">DATABASE_TITLE_MAX_LEN</span><span class="p">,</span>
    <span class="n">FILTER_TEXT_MAX_LEN</span><span class="p">,</span>
    <span class="n">FULLNAME_MAX_LEN</span><span class="p">,</span>
    <span class="n">GROUP_DESCRIPTION_MAX_LEN</span><span class="p">,</span>
    <span class="n">GROUP_NAME_MAX_LEN</span><span class="p">,</span>
    <span class="n">HL7_AA_MAX_LEN</span><span class="p">,</span>
    <span class="n">HL7_ID_TYPE_MAX_LEN</span><span class="p">,</span>
    <span class="n">ID_DESCRIPTOR_MAX_LEN</span><span class="p">,</span>
    <span class="n">USERNAME_MAX_LEN</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.cc_unittest</span> <span class="k">import</span> <span class="n">DemoRequestTestCase</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.cc_request</span> <span class="k">import</span> <span class="n">CamcopsRequest</span>
    <span class="kn">from</span> <span class="nn">.cc_user</span> <span class="k">import</span> <span class="n">User</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">BraceStyleAdapter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">))</span>

<span class="n">ColanderNullType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">colander</span><span class="o">.</span><span class="n">null</span><span class="p">)</span>
<span class="n">ValidatorType</span> <span class="o">=</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">SchemaNode</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>  <span class="c1"># called as v(node, value)</span>

<span class="c1"># =============================================================================</span>
<span class="c1"># Debugging options</span>
<span class="c1"># =============================================================================</span>

<span class="n">DEBUG_CSRF_CHECK</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">if</span> <span class="n">DEBUG_CSRF_CHECK</span><span class="p">:</span>
    <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Debugging options enabled!&quot;</span><span class="p">)</span>

<span class="c1"># =============================================================================</span>
<span class="c1"># Constants</span>
<span class="c1"># =============================================================================</span>

<span class="n">OR_JOIN_DESCRIPTION</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;If you specify more than one, they will be joined with OR.&quot;</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">Binding</span><span class="p">:</span>
    <span class="c1"># Must match kwargs of calls to bind() function of each Schema</span>
    <span class="n">GROUP</span> <span class="o">=</span> <span class="s2">&quot;group&quot;</span>
    <span class="n">OPEN_ADMIN</span> <span class="o">=</span> <span class="s2">&quot;open_admin&quot;</span>
    <span class="n">OPEN_WHAT</span> <span class="o">=</span> <span class="s2">&quot;open_what&quot;</span>
    <span class="n">OPEN_WHEN</span> <span class="o">=</span> <span class="s2">&quot;open_when&quot;</span>
    <span class="n">OPEN_WHO</span> <span class="o">=</span> <span class="s2">&quot;open_who&quot;</span>
    <span class="n">REQUEST</span> <span class="o">=</span> <span class="s2">&quot;request&quot;</span>
    <span class="n">TRACKER_TASKS_ONLY</span> <span class="o">=</span> <span class="s2">&quot;tracker_tasks_only&quot;</span>
    <span class="n">USER</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># CSRF</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># As per http://deformdemo.repoze.org/pyramid_csrf_demo/, modified for a more</span>
<span class="c1"># recent Colander API.</span>
<span class="c1"># NOTE that this makes use of colander.SchemaNode.bind; this CLONES the Schema,</span>
<span class="c1"># and resolves any deferred values by means of the keywords passed to bind().</span>
<span class="c1"># Since the Schema is created at module load time, but since we&#39;re asking the</span>
<span class="c1"># Schema to know about the request&#39;s CSRF values, this is the only mechanism.</span>
<span class="c1"># https://docs.pylonsproject.org/projects/colander/en/latest/api.html#colander.SchemaNode.bind  # noqa</span>

<div class="viewcode-block" id="CSRFToken"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.CSRFToken">[docs]</a><span class="k">class</span> <span class="nc">CSRFToken</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    From http://deform2000.readthedocs.io/en/latest/basics.html:</span>

<span class="sd">    &quot;The default of a schema node indicates the value to be serialized if a</span>
<span class="sd">    value for the schema node is not found in the input data during</span>
<span class="sd">    serialization. It should be the deserialized representation. If a schema</span>
<span class="sd">    node does not have a default, it is considered &quot;serialization required&quot;.&quot;</span>

<span class="sd">    &quot;The missing of a schema node indicates the value to be deserialized if a</span>
<span class="sd">    value for the schema node is not found in the input data during</span>
<span class="sd">    deserialization. It should be the deserialized representation. If a schema</span>
<span class="sd">    node does not have a missing value, a colander.Invalid exception will be</span>
<span class="sd">    raised if the data structure being deserialized does not contain a matching</span>
<span class="sd">    value.&quot;</span>

<span class="sd">    RNC: Serialized values are always STRINGS.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;CSRF token&quot;</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">HiddenWidget</span><span class="p">()</span>

    <span class="c1"># noinspection PyUnusedLocal</span>
    <span class="k">def</span> <span class="nf">after_bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">kw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">csrf_token</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_csrf_token</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">DEBUG_CSRF_CHECK</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Got CSRF token from session: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">csrf_token</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">csrf_token</span>

    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Deferred validator via method, as per</span>
        <span class="c1"># https://docs.pylonsproject.org/projects/colander/en/latest/basics.html  # noqa</span>
        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">csrf_token</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_csrf_token</span><span class="p">()</span>  <span class="c1"># type: str</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">value</span> <span class="o">==</span> <span class="n">csrf_token</span>
        <span class="k">if</span> <span class="n">DEBUG_CSRF_CHECK</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Validating CSRF token: form says </span><span class="si">{!r}</span><span class="s2">, session says &quot;</span>
                      <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2">, matches = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">csrf_token</span><span class="p">,</span> <span class="n">matches</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;CSRF token mismatch; remote address </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">req</span><span class="o">.</span><span class="n">remote_addr</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;Bad CSRF token&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="CSRFSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.CSRFSchema">[docs]</a><span class="k">class</span> <span class="nc">CSRFSchema</span><span class="p">(</span><span class="n">Schema</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for form schemas that use CSRF (XSRF; cross-site request</span>
<span class="sd">    forgery) tokens.</span>

<span class="sd">    You can&#39;t put the call to bind() at the end of __init__(), because bind()</span>
<span class="sd">    calls clone() with no arguments and clone() ends up calling __init__()...</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">csrf</span> <span class="o">=</span> <span class="n">CSRFToken</span><span class="p">()</span>  <span class="c1"># name must match ViewParam.CSRF_TOKEN</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># Specialized Form classes</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="SimpleSubmitForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.SimpleSubmitForm">[docs]</a><span class="k">class</span> <span class="nc">SimpleSubmitForm</span><span class="p">(</span><span class="n">InformativeForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">schema_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Schema</span><span class="p">],</span>
                 <span class="n">submit_title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">schema_class</span><span class="p">()</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">schema</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="p">[</span><span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">SUBMIT</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="n">submit_title</span><span class="p">)],</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ApplyCancelForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ApplyCancelForm">[docs]</a><span class="k">class</span> <span class="nc">ApplyCancelForm</span><span class="p">(</span><span class="n">InformativeForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">schema_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Schema</span><span class="p">],</span>
                 <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">schema_class</span><span class="p">()</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">schema</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="p">[</span>
                <span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">SUBMIT</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Apply&quot;</span><span class="p">),</span>
                <span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cancel&quot;</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="AddCancelForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AddCancelForm">[docs]</a><span class="k">class</span> <span class="nc">AddCancelForm</span><span class="p">(</span><span class="n">InformativeForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">schema_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Schema</span><span class="p">],</span>
                 <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">schema_class</span><span class="p">()</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">schema</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="p">[</span>
                <span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">SUBMIT</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Add&quot;</span><span class="p">),</span>
                <span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cancel&quot;</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="DangerousForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.DangerousForm">[docs]</a><span class="k">class</span> <span class="nc">DangerousForm</span><span class="p">(</span><span class="n">DynamicDescriptionsForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">schema_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Schema</span><span class="p">],</span>
                 <span class="n">submit_action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">submit_title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">schema_class</span><span class="p">()</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">schema</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="p">[</span>
                <span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">submit_action</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">submit_title</span><span class="p">,</span>
                       <span class="n">css_class</span><span class="o">=</span><span class="s2">&quot;btn-danger&quot;</span><span class="p">),</span>
                <span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cancel&quot;</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="DeleteCancelForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.DeleteCancelForm">[docs]</a><span class="k">class</span> <span class="nc">DeleteCancelForm</span><span class="p">(</span><span class="n">DangerousForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">schema_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Schema</span><span class="p">],</span>
                 <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">schema_class</span><span class="o">=</span><span class="n">schema_class</span><span class="p">,</span>
            <span class="n">submit_action</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span>
            <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;Delete&quot;</span><span class="p">,</span>
            <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># Specialized SchemaNode classes</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="OptionalSingleTaskSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OptionalSingleTaskSelector">[docs]</a><span class="k">class</span> <span class="nc">OptionalSingleTaskSelector</span><span class="p">(</span><span class="n">OptionalStringNode</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Task type&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">tracker_tasks_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker_tasks_only</span> <span class="o">=</span> <span class="n">tracker_tasks_only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ValidatorType</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># noinspection PyUnusedLocal</span>
    <span class="k">def</span> <span class="nf">after_bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">kw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Binding</span><span class="o">.</span><span class="n">TRACKER_TASKS_ONLY</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker_tasks_only</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">TRACKER_TASKS_ONLY</span><span class="p">]</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get_values_and_permissible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_task_choices</span><span class="p">(),</span>
                                                <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;[Any]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">SelectWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_task_choices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="kn">from</span> <span class="nn">.cc_task</span> <span class="k">import</span> <span class="n">Task</span>  <span class="c1"># delayed import</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[Tuple[str, str]]</span>
        <span class="k">for</span> <span class="n">tc</span> <span class="ow">in</span> <span class="n">Task</span><span class="o">.</span><span class="n">all_subclasses_by_shortname</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracker_tasks_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">tc</span><span class="o">.</span><span class="n">provides_trackers</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">choices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tc</span><span class="o">.</span><span class="n">tablename</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">shortname</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">choices</span></div>


<div class="viewcode-block" id="MultiTaskSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.MultiTaskSelector">[docs]</a><span class="k">class</span> <span class="nc">MultiTaskSelector</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">Set</span>
    <span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Task type(s)&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;If none are selected, all task types will be offered. &quot;</span> <span class="o">+</span>
        <span class="n">OR_JOIN_DESCRIPTION</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">tracker_tasks_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">minimum_number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracker_tasks_only</span> <span class="o">=</span> <span class="n">tracker_tasks_only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum_number</span> <span class="o">=</span> <span class="n">minimum_number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Widget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: object</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># noinspection PyUnusedLocal</span>
    <span class="k">def</span> <span class="nf">after_bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">kw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Binding</span><span class="o">.</span><span class="n">TRACKER_TASKS_ONLY</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracker_tasks_only</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">TRACKER_TASKS_ONLY</span><span class="p">]</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get_values_and_permissible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_task_choices</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">CheckboxChoiceWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum_number</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_task_choices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
        <span class="kn">from</span> <span class="nn">.cc_task</span> <span class="k">import</span> <span class="n">Task</span>  <span class="c1"># delayed import</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[Tuple[str, str]]</span>
        <span class="k">for</span> <span class="n">tc</span> <span class="ow">in</span> <span class="n">Task</span><span class="o">.</span><span class="n">all_subclasses_by_shortname</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracker_tasks_only</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">tc</span><span class="o">.</span><span class="n">provides_trackers</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">choices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tc</span><span class="o">.</span><span class="n">tablename</span><span class="p">,</span> <span class="n">tc</span><span class="o">.</span><span class="n">shortname</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">choices</span></div>


<div class="viewcode-block" id="MandatoryWhichIdNumSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.MandatoryWhichIdNumSelector">[docs]</a><span class="k">class</span> <span class="nc">MandatoryWhichIdNumSelector</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Identifier&quot;</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">SelectWidget</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;allow_none&quot;</span><span class="p">):</span>
            <span class="c1"># ... allows parameter-free (!) inheritance by OptionalWhichIdNumSelector  # noqa</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># noinspection PyUnusedLocal</span>
    <span class="k">def</span> <span class="nf">after_bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">kw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[Tuple[Optional[int], str]]</span>
        <span class="k">for</span> <span class="n">iddef</span> <span class="ow">in</span> <span class="n">req</span><span class="o">.</span><span class="n">idnum_definitions</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">iddef</span><span class="o">.</span><span class="n">which_idnum</span><span class="p">,</span> <span class="n">iddef</span><span class="o">.</span><span class="n">description</span><span class="p">))</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get_values_and_permissible</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span><span class="p">,</span>
                                                <span class="s2">&quot;[ignore]&quot;</span><span class="p">)</span>
        <span class="c1"># ... can&#39;t use None, because SelectWidget() will convert that to</span>
        <span class="c1"># &quot;None&quot;; can&#39;t use colander.null, because that converts to</span>
        <span class="c1"># &quot;&lt;colander.null&gt;&quot;; use &quot;&quot;, which is the default null_value of</span>
        <span class="c1"># SelectWidget.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">schema_type</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">SchemaType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Integer</span><span class="p">()</span></div>


<div class="viewcode-block" id="LinkingIdNumSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.LinkingIdNumSelector">[docs]</a><span class="k">class</span> <span class="nc">LinkingIdNumSelector</span><span class="p">(</span><span class="n">MandatoryWhichIdNumSelector</span><span class="p">):</span>
    <span class="c1"># Convenience class</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Linking ID number&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Which ID number to link on?&quot;</span></div>


<div class="viewcode-block" id="OptionalWhichIdNumSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OptionalWhichIdNumSelector">[docs]</a><span class="k">class</span> <span class="nc">OptionalWhichIdNumSelector</span><span class="p">(</span><span class="n">MandatoryWhichIdNumSelector</span><span class="p">):</span>
    <span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">schema_type</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">SchemaType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">AllowNoneType</span><span class="p">(</span><span class="n">Integer</span><span class="p">())</span></div>


<div class="viewcode-block" id="MandatoryIdNumValue"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.MandatoryIdNumValue">[docs]</a><span class="k">class</span> <span class="nc">MandatoryIdNumValue</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">Integer</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;ID# value&quot;</span>
    <span class="n">validator</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="OptionalIdNumValue"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OptionalIdNumValue">[docs]</a><span class="k">class</span> <span class="nc">OptionalIdNumValue</span><span class="p">(</span><span class="n">MandatoryIdNumValue</span><span class="p">):</span>
    <span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="OptionalIdNumValue.schema_type"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OptionalIdNumValue.schema_type">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">schema_type</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">SchemaType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">AllowNoneType</span><span class="p">(</span><span class="n">Integer</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="MandatoryIdNumNode"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.MandatoryIdNumNode">[docs]</a><span class="k">class</span> <span class="nc">MandatoryIdNumNode</span><span class="p">(</span><span class="n">MappingSchema</span><span class="p">):</span>
    <span class="n">which_idnum</span> <span class="o">=</span> <span class="n">MandatoryWhichIdNumSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.WHICH_IDNUM  # noqa</span>
    <span class="n">idnum_value</span> <span class="o">=</span> <span class="n">MandatoryIdNumValue</span><span class="p">()</span>  <span class="c1"># must match ViewParam.IDNUM_VALUE</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;ID number&quot;</span></div>


<div class="viewcode-block" id="IdNumSequenceAnyCombination"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.IdNumSequenceAnyCombination">[docs]</a><span class="k">class</span> <span class="nc">IdNumSequenceAnyCombination</span><span class="p">(</span><span class="n">SequenceSchema</span><span class="p">):</span>
    <span class="n">idnum_sequence</span> <span class="o">=</span> <span class="n">MandatoryIdNumNode</span><span class="p">()</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;ID numbers&quot;</span>

    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># log.critical(&quot;IdNumSequence.validator: {!r}&quot;, value)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="n">list_of_lists</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">WHICH_IDNUM</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">IDNUM_VALUE</span><span class="p">])</span>
                         <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;You have specified duplicate ID definitions&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="IdNumSequenceUniquePerWhichIdnum"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.IdNumSequenceUniquePerWhichIdnum">[docs]</a><span class="k">class</span> <span class="nc">IdNumSequenceUniquePerWhichIdnum</span><span class="p">(</span><span class="n">SequenceSchema</span><span class="p">):</span>
    <span class="n">idnum_sequence</span> <span class="o">=</span> <span class="n">MandatoryIdNumNode</span><span class="p">()</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;ID numbers&quot;</span>

    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># log.critical(&quot;IdNumSequence.validator: {!r}&quot;, value)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="n">which_idnums</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">WHICH_IDNUM</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">which_idnums</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">which_idnums</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span>
                <span class="n">node</span><span class="p">,</span>
                <span class="s2">&quot;You have specified &gt;1 value for one ID number type&quot;</span><span class="p">)</span></div>


<span class="n">SEX_CHOICES</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">)]</span>


<div class="viewcode-block" id="OptionalSexSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OptionalSexSelector">[docs]</a><span class="k">class</span> <span class="nc">OptionalSexSelector</span><span class="p">(</span><span class="n">OptionalStringNode</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Sex&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get_values_and_permissible</span><span class="p">(</span><span class="n">SEX_CHOICES</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Any&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">RadioChoiceWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="MandatorySexSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.MandatorySexSelector">[docs]</a><span class="k">class</span> <span class="nc">MandatorySexSelector</span><span class="p">(</span><span class="n">MandatoryStringNode</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Sex&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get_values_and_permissible</span><span class="p">(</span><span class="n">SEX_CHOICES</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">RadioChoiceWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="MandatoryUserIdSelectorUsersAllowedToSee"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.MandatoryUserIdSelectorUsersAllowedToSee">[docs]</a><span class="k">class</span> <span class="nc">MandatoryUserIdSelectorUsersAllowedToSee</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">Integer</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;User&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Widget</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># noinspection PyUnusedLocal</span>
    <span class="k">def</span> <span class="nf">after_bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">kw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.cc_user</span> <span class="k">import</span> <span class="n">User</span>  <span class="c1"># delayed import</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">dbsession</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">dbsession</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">user</span>
        <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">superuser</span><span class="p">:</span>
            <span class="n">users</span> <span class="o">=</span> <span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Users in my groups, or groups I&#39;m allowed to see</span>
            <span class="n">my_allowed_group_ids</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">ids_of_groups_user_may_see</span>
            <span class="n">users</span> <span class="o">=</span> <span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>\
                <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Group</span><span class="p">)</span>\
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Group</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">my_allowed_group_ids</span><span class="p">))</span>\
                <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[Tuple[Optional[int], str]]</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get_values_and_permissible</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">SelectWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span></div>


<div class="viewcode-block" id="OptionalUserNameSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OptionalUserNameSelector">[docs]</a><span class="k">class</span> <span class="nc">OptionalUserNameSelector</span><span class="p">(</span><span class="n">OptionalStringNode</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;User&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Widget</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># noinspection PyUnusedLocal</span>
    <span class="k">def</span> <span class="nf">after_bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">kw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.cc_user</span> <span class="k">import</span> <span class="n">User</span>  <span class="c1"># delayed import</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">dbsession</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">dbsession</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[Tuple[str, str]]</span>
        <span class="n">users</span> <span class="o">=</span> <span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get_values_and_permissible</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;[ignore]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">SelectWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span></div>


<div class="viewcode-block" id="MandatoryDeviceIdSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.MandatoryDeviceIdSelector">[docs]</a><span class="k">class</span> <span class="nc">MandatoryDeviceIdSelector</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">Integer</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Device&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Widget</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># noinspection PyUnusedLocal</span>
    <span class="k">def</span> <span class="nf">after_bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">kw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.cc_device</span> <span class="k">import</span> <span class="n">Device</span>  <span class="c1"># delayed import</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">dbsession</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">dbsession</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Device</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Device</span><span class="o">.</span><span class="n">friendly_name</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[Tuple[Optional[int], str]]</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">device</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">device</span><span class="o">.</span><span class="n">friendly_name</span><span class="p">))</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get_values_and_permissible</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">SelectWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span></div>


<div class="viewcode-block" id="ServerPkSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ServerPkSelector">[docs]</a><span class="k">class</span> <span class="nc">ServerPkSelector</span><span class="p">(</span><span class="n">OptionalIntNode</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Server PK&quot;</span></div>


<div class="viewcode-block" id="StartPendulumSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.StartPendulumSelector">[docs]</a><span class="k">class</span> <span class="nc">StartPendulumSelector</span><span class="p">(</span><span class="n">OptionalPendulumNode</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Start date/time&quot;</span></div>


<div class="viewcode-block" id="EndPendulumSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EndPendulumSelector">[docs]</a><span class="k">class</span> <span class="nc">EndPendulumSelector</span><span class="p">(</span><span class="n">OptionalPendulumNode</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;End date/time&quot;</span></div>


<div class="viewcode-block" id="StartDateTimeSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.StartDateTimeSelector">[docs]</a><span class="k">class</span> <span class="nc">StartDateTimeSelector</span><span class="p">(</span><span class="n">DateTimeSelectorNode</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Start date/time (UTC)&quot;</span></div>


<div class="viewcode-block" id="EndDateTimeSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EndDateTimeSelector">[docs]</a><span class="k">class</span> <span class="nc">EndDateTimeSelector</span><span class="p">(</span><span class="n">DateTimeSelectorNode</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;End date/time (UTC)&quot;</span></div>


<div class="viewcode-block" id="StartDateSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.StartDateSelector">[docs]</a><span class="k">class</span> <span class="nc">StartDateSelector</span><span class="p">(</span><span class="n">DateSelectorNode</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Start date (UTC)&quot;</span></div>


<div class="viewcode-block" id="EndDateSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EndDateSelector">[docs]</a><span class="k">class</span> <span class="nc">EndDateSelector</span><span class="p">(</span><span class="n">DateSelectorNode</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;End date (UTC)&quot;</span></div>


<div class="viewcode-block" id="RowsPerPageSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.RowsPerPageSelector">[docs]</a><span class="k">class</span> <span class="nc">RowsPerPageSelector</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">_choices</span> <span class="o">=</span> <span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="s2">&quot;25&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;50&quot;</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;100&quot;</span><span class="p">))</span>

    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">Integer</span>
    <span class="n">default</span> <span class="o">=</span> <span class="n">DEFAULT_ROWS_PER_PAGE</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Items to show per page&quot;</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">RadioChoiceWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">_choices</span><span class="p">)</span>
    <span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_choices</span><span class="p">))</span></div>


<div class="viewcode-block" id="TaskTrackerOutputTypeSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.TaskTrackerOutputTypeSelector">[docs]</a><span class="k">class</span> <span class="nc">TaskTrackerOutputTypeSelector</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">_choices</span> <span class="o">=</span> <span class="p">((</span><span class="n">ViewArg</span><span class="o">.</span><span class="n">HTML</span><span class="p">,</span> <span class="s2">&quot;HTML&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">ViewArg</span><span class="o">.</span><span class="n">PDF</span><span class="p">,</span> <span class="s2">&quot;PDF&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">ViewArg</span><span class="o">.</span><span class="n">XML</span><span class="p">,</span> <span class="s2">&quot;XML&quot;</span><span class="p">))</span>

    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">default</span> <span class="o">=</span> <span class="n">ViewArg</span><span class="o">.</span><span class="n">HTML</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="n">ViewArg</span><span class="o">.</span><span class="n">HTML</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;View as&quot;</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">RadioChoiceWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">_choices</span><span class="p">)</span>
    <span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_choices</span><span class="p">))</span></div>


<div class="viewcode-block" id="ReportOutputTypeSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ReportOutputTypeSelector">[docs]</a><span class="k">class</span> <span class="nc">ReportOutputTypeSelector</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">_choices</span> <span class="o">=</span> <span class="p">((</span><span class="n">ViewArg</span><span class="o">.</span><span class="n">HTML</span><span class="p">,</span> <span class="s2">&quot;HTML&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="n">ViewArg</span><span class="o">.</span><span class="n">TSV</span><span class="p">,</span> <span class="s2">&quot;TSV (tab-separated values)&quot;</span><span class="p">))</span>

    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">default</span> <span class="o">=</span> <span class="n">ViewArg</span><span class="o">.</span><span class="n">HTML</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="n">ViewArg</span><span class="o">.</span><span class="n">HTML</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;View as&quot;</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">RadioChoiceWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">_choices</span><span class="p">)</span>
    <span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_choices</span><span class="p">))</span></div>


<div class="viewcode-block" id="DumpTypeSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.DumpTypeSelector">[docs]</a><span class="k">class</span> <span class="nc">DumpTypeSelector</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">_choices</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">ViewArg</span><span class="o">.</span><span class="n">EVERYTHING</span><span class="p">,</span> <span class="s2">&quot;Everything&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ViewArg</span><span class="o">.</span><span class="n">USE_SESSION_FILTER</span><span class="p">,</span> <span class="s2">&quot;Use the session filter settings&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ViewArg</span><span class="o">.</span><span class="n">SPECIFIC_TASKS_GROUPS</span><span class="p">,</span> <span class="s2">&quot;Specify tasks/groups manually &quot;</span>
                                        <span class="s2">&quot;(see below)&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">default</span> <span class="o">=</span> <span class="n">ViewArg</span><span class="o">.</span><span class="n">EVERYTHING</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="n">ViewArg</span><span class="o">.</span><span class="n">EVERYTHING</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Dump method&quot;</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">RadioChoiceWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">_choices</span><span class="p">)</span>
    <span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_choices</span><span class="p">))</span></div>


<div class="viewcode-block" id="UsernameNode"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.UsernameNode">[docs]</a><span class="k">class</span> <span class="nc">UsernameNode</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Username&quot;</span>
    <span class="n">_length_validator</span> <span class="o">=</span> <span class="n">Length</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">USERNAME_MAX_LEN</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">USER_NAME_FOR_SYSTEM</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;Cannot use system username </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">USER_NAME_FOR_SYSTEM</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_length_validator</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="MustChangePasswordNode"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.MustChangePasswordNode">[docs]</a><span class="k">class</span> <span class="nc">MustChangePasswordNode</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">Boolean</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;User must change password at next login&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Must change password at next login?&quot;</span>
    <span class="n">default</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="NewPasswordNode"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.NewPasswordNode">[docs]</a><span class="k">class</span> <span class="nc">NewPasswordNode</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">validator</span> <span class="o">=</span> <span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">MINIMUM_PASSWORD_LENGTH</span><span class="p">)</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">CheckedPasswordWidget</span><span class="p">()</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;New password&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Type the new password and confirm it&quot;</span></div>


<div class="viewcode-block" id="MandatoryGroupIdSelectorAllGroups"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.MandatoryGroupIdSelectorAllGroups">[docs]</a><span class="k">class</span> <span class="nc">MandatoryGroupIdSelectorAllGroups</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Offers a picklist of groups from ALL POSSIBLE GROUPS.</span>
<span class="sd">    Used by superusers: add user to any group.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Group&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Widget</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># noinspection PyUnusedLocal</span>
    <span class="k">def</span> <span class="nf">after_bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">kw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">dbsession</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">dbsession</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Group</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Group</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get_values_and_permissible</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">SelectWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">schema_type</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">SchemaType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Integer</span><span class="p">()</span></div>


<div class="viewcode-block" id="MandatoryGroupIdSelectorAdministeredGroups"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.MandatoryGroupIdSelectorAdministeredGroups">[docs]</a><span class="k">class</span> <span class="nc">MandatoryGroupIdSelectorAdministeredGroups</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Offers a picklist of groups from GROUPS ADMINISTERED BY REQUESTOR.</span>
<span class="sd">    Used by groupadmins: add user to my group(s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Group&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Widget</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># noinspection PyUnusedLocal</span>
    <span class="k">def</span> <span class="nf">after_bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">kw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">dbsession</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">dbsession</span>
        <span class="n">administered_group_ids</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">ids_of_groups_user_is_admin_for</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Group</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Group</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span>
                  <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">administered_group_ids</span><span class="p">]</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get_values_and_permissible</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">SelectWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">schema_type</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">SchemaType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Integer</span><span class="p">()</span></div>


<div class="viewcode-block" id="MandatoryGroupIdSelectorOtherGroups"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.MandatoryGroupIdSelectorOtherGroups">[docs]</a><span class="k">class</span> <span class="nc">MandatoryGroupIdSelectorOtherGroups</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Offers a picklist of groups THAT ARE NOT THE SPECIFIED GROUP.</span>
<span class="sd">    Used by superusers: &quot;which other groups can this group see?&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Other group&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Widget</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># noinspection PyUnusedLocal</span>
    <span class="k">def</span> <span class="nf">after_bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">kw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">GROUP</span><span class="p">]</span>  <span class="c1"># type: Group  # ATYPICAL BINDING</span>
        <span class="n">dbsession</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">dbsession</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Group</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Group</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span> <span class="k">if</span> <span class="n">g</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">group</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get_values_and_permissible</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">SelectWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">schema_type</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">SchemaType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Integer</span><span class="p">()</span></div>


<div class="viewcode-block" id="MandatoryGroupIdSelectorUserGroups"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.MandatoryGroupIdSelectorUserGroups">[docs]</a><span class="k">class</span> <span class="nc">MandatoryGroupIdSelectorUserGroups</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Offers a picklist of groups from THOSE THE USER IS A MEMBER OF.</span>
<span class="sd">    Used for: &quot;which of your groups do you want to upload into?&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Group&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;allow_none&quot;</span><span class="p">):</span>
            <span class="c1"># ... allows parameter-free (!) inheritance by OptionalGroupIdSelectorUserGroups  # noqa</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Widget</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># noinspection PyUnusedLocal</span>
    <span class="k">def</span> <span class="nf">after_bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">kw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">USER</span><span class="p">]</span>  <span class="c1"># type: User  # ATYPICAL BINDING</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">groups</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get_values_and_permissible</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span><span class="p">,</span>
                                                <span class="s2">&quot;[None]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">SelectWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">schema_type</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">SchemaType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Integer</span><span class="p">()</span></div>


<div class="viewcode-block" id="OptionalGroupIdSelectorUserGroups"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OptionalGroupIdSelectorUserGroups">[docs]</a><span class="k">class</span> <span class="nc">OptionalGroupIdSelectorUserGroups</span><span class="p">(</span><span class="n">MandatoryGroupIdSelectorUserGroups</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Offers a picklist of groups from THOSE THE USER IS A MEMBER OF.</span>
<span class="sd">    Used for &quot;which do you want to upload into?&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">schema_type</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">SchemaType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">AllowNoneType</span><span class="p">(</span><span class="n">Integer</span><span class="p">())</span></div>


<div class="viewcode-block" id="MandatoryGroupIdSelectorAllowedGroups"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.MandatoryGroupIdSelectorAllowedGroups">[docs]</a><span class="k">class</span> <span class="nc">MandatoryGroupIdSelectorAllowedGroups</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Offers a picklist of groups from THOSE THE USER IS ALLOWED TO SEE.</span>
<span class="sd">    Used for task filters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Group&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Widget</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># noinspection PyUnusedLocal</span>
    <span class="k">def</span> <span class="nf">after_bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">kw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">dbsession</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">dbsession</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">user</span>
        <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">superuser</span><span class="p">:</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="n">dbsession</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Group</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Group</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">groups</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">groups</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[(</span><span class="n">g</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get_values_and_permissible</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">SelectWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">schema_type</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">SchemaType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Integer</span><span class="p">()</span></div>


<div class="viewcode-block" id="GroupsSequenceBase"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.GroupsSequenceBase">[docs]</a><span class="k">class</span> <span class="nc">GroupsSequenceBase</span><span class="p">(</span><span class="n">SequenceSchema</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Groups&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">minimum_number</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum_number</span> <span class="o">=</span> <span class="n">minimum_number</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                  <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span>
                  <span class="n">value</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># log.critical(&quot;GroupsSequenceBase.validator: {!r}&quot;, value)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;You have specified duplicate groups&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimum_number</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;You must specify at least </span><span class="si">{}</span><span class="s2"> group(s)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">minimum_number</span><span class="p">))</span></div>


<div class="viewcode-block" id="AllGroupsSequence"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AllGroupsSequence">[docs]</a><span class="k">class</span> <span class="nc">AllGroupsSequence</span><span class="p">(</span><span class="n">GroupsSequenceBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Typical use: superuser assigns group memberships to a user.</span>
<span class="sd">    Offer all possible groups.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">group_id_sequence</span> <span class="o">=</span> <span class="n">MandatoryGroupIdSelectorAllGroups</span><span class="p">()</span></div>


<div class="viewcode-block" id="AdministeredGroupsSequence"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AdministeredGroupsSequence">[docs]</a><span class="k">class</span> <span class="nc">AdministeredGroupsSequence</span><span class="p">(</span><span class="n">GroupsSequenceBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Typical use: (non-superuser) group administrator assigns group memberships</span>
<span class="sd">    to a user.</span>
<span class="sd">    Offers the groups administered by the requestor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">group_id_sequence</span> <span class="o">=</span> <span class="n">MandatoryGroupIdSelectorAdministeredGroups</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">minimum_number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="AllOtherGroupsSequence"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AllOtherGroupsSequence">[docs]</a><span class="k">class</span> <span class="nc">AllOtherGroupsSequence</span><span class="p">(</span><span class="n">GroupsSequenceBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Typical use: superuser assigns group permissions to another group.</span>
<span class="sd">    Offer all possible OTHER groups.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">group_id_sequence</span> <span class="o">=</span> <span class="n">MandatoryGroupIdSelectorOtherGroups</span><span class="p">()</span></div>


<div class="viewcode-block" id="AllowedGroupsSequence"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AllowedGroupsSequence">[docs]</a><span class="k">class</span> <span class="nc">AllowedGroupsSequence</span><span class="p">(</span><span class="n">GroupsSequenceBase</span><span class="p">):</span>
    <span class="n">group_id_sequence</span> <span class="o">=</span> <span class="n">MandatoryGroupIdSelectorAllowedGroups</span><span class="p">()</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">OR_JOIN_DESCRIPTION</span></div>


<div class="viewcode-block" id="TextContentsSequence"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.TextContentsSequence">[docs]</a><span class="k">class</span> <span class="nc">TextContentsSequence</span><span class="p">(</span><span class="n">SequenceSchema</span><span class="p">):</span>
    <span class="n">text_sequence</span> <span class="o">=</span> <span class="n">SchemaNode</span><span class="p">(</span>
        <span class="n">String</span><span class="p">(),</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Text contents criterion&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FILTER_TEXT_MAX_LEN</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Text contents&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">OR_JOIN_DESCRIPTION</span>

    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;You have specified duplicate text filters&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="UploadingUserSequence"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.UploadingUserSequence">[docs]</a><span class="k">class</span> <span class="nc">UploadingUserSequence</span><span class="p">(</span><span class="n">SequenceSchema</span><span class="p">):</span>
    <span class="n">user_id_sequence</span> <span class="o">=</span> <span class="n">MandatoryUserIdSelectorUsersAllowedToSee</span><span class="p">()</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Uploading users&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">OR_JOIN_DESCRIPTION</span>

    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;You have specified duplicate users&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DevicesSequence"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.DevicesSequence">[docs]</a><span class="k">class</span> <span class="nc">DevicesSequence</span><span class="p">(</span><span class="n">SequenceSchema</span><span class="p">):</span>
    <span class="n">device_id_sequence</span> <span class="o">=</span> <span class="n">MandatoryDeviceIdSelector</span><span class="p">()</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Uploading devices&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">OR_JOIN_DESCRIPTION</span>

    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">value</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;You have specified duplicate devices&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="SortTsvByHeadingsNode"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.SortTsvByHeadingsNode">[docs]</a><span class="k">class</span> <span class="nc">SortTsvByHeadingsNode</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">Boolean</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Sort TSV files by heading (column) names?&quot;</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Sort columns?&quot;</span>
    <span class="n">default</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="kc">False</span></div>


<span class="n">DIALECT_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># http://docs.sqlalchemy.org/en/latest/dialects/</span>
    <span class="p">(</span><span class="n">SqlaDialectName</span><span class="o">.</span><span class="n">MYSQL</span><span class="p">,</span> <span class="s2">&quot;MySQL&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">SqlaDialectName</span><span class="o">.</span><span class="n">MSSQL</span><span class="p">,</span> <span class="s2">&quot;Microsoft SQL Server&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">SqlaDialectName</span><span class="o">.</span><span class="n">ORACLE</span><span class="p">,</span> <span class="s2">&quot;Oracle [WILL NOT WORK]&quot;</span><span class="p">),</span>
    <span class="c1"># ... Oracle doesn&#39;t work; SQLAlchemy enforces the Oracle rule of a 30-</span>
    <span class="c1"># character limit for identifiers, only relaxed to 128 characters in</span>
    <span class="c1"># Oracle 12.2 (March 2017).</span>
    <span class="p">(</span><span class="n">SqlaDialectName</span><span class="o">.</span><span class="n">FIREBIRD</span><span class="p">,</span> <span class="s2">&quot;Firebird&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">SqlaDialectName</span><span class="o">.</span><span class="n">POSTGRES</span><span class="p">,</span> <span class="s2">&quot;PostgreSQL&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">SqlaDialectName</span><span class="o">.</span><span class="n">SQLITE</span><span class="p">,</span> <span class="s2">&quot;SQLite&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">SqlaDialectName</span><span class="o">.</span><span class="n">SYBASE</span><span class="p">,</span> <span class="s2">&quot;Sybase&quot;</span><span class="p">),</span>
<span class="p">)</span>


<div class="viewcode-block" id="DatabaseDialectSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.DatabaseDialectSelector">[docs]</a><span class="k">class</span> <span class="nc">DatabaseDialectSelector</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">default</span> <span class="o">=</span> <span class="n">SqlaDialectName</span><span class="o">.</span><span class="n">MYSQL</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="n">SqlaDialectName</span><span class="o">.</span><span class="n">MYSQL</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;SQL dialect to use (not all may be valid)&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get_values_and_permissible</span><span class="p">(</span><span class="n">DIALECT_CHOICES</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">RadioChoiceWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="n">SQLITE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="c1"># http://docs.sqlalchemy.org/en/latest/dialects/</span>
    <span class="p">(</span><span class="n">ViewArg</span><span class="o">.</span><span class="n">SQLITE</span><span class="p">,</span> <span class="s2">&quot;Binary SQLite database&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">ViewArg</span><span class="o">.</span><span class="n">SQL</span><span class="p">,</span> <span class="s2">&quot;SQL text to create SQLite database&quot;</span><span class="p">),</span>
<span class="p">)</span>


<div class="viewcode-block" id="SqliteSelector"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.SqliteSelector">[docs]</a><span class="k">class</span> <span class="nc">SqliteSelector</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">default</span> <span class="o">=</span> <span class="n">ViewArg</span><span class="o">.</span><span class="n">SQLITE</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="n">ViewArg</span><span class="o">.</span><span class="n">SQLITE</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Database download method&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">pv</span> <span class="o">=</span> <span class="n">get_values_and_permissible</span><span class="p">(</span><span class="n">SQLITE_CHOICES</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">RadioChoiceWidget</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">OneOf</span><span class="p">(</span><span class="n">pv</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="IncludeBlobsNode"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.IncludeBlobsNode">[docs]</a><span class="k">class</span> <span class="nc">IncludeBlobsNode</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">Boolean</span>
    <span class="n">default</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">missing</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Include BLOBs?&quot;</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Include binary large objects (BLOBs)? WARNING: may be large&quot;</span></div>


<div class="viewcode-block" id="PolicyNode"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.PolicyNode">[docs]</a><span class="k">class</span> <span class="nc">PolicyNode</span><span class="p">(</span><span class="n">MandatoryStringNode</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># unlikely!</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;Not a string&quot;</span><span class="p">)</span>
        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">policy</span> <span class="o">=</span> <span class="n">TokenizedPolicy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">policy</span><span class="o">.</span><span class="n">is_syntactically_valid</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;Syntactically invalid policy&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">policy</span><span class="o">.</span><span class="n">is_valid_from_req</span><span class="p">(</span><span class="n">req</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;Invalid policy (have you referred to &quot;</span>
                                <span class="s2">&quot;non-existent ID numbers?&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="IdDefinitionDescriptionNode"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.IdDefinitionDescriptionNode">[docs]</a><span class="k">class</span> <span class="nc">IdDefinitionDescriptionNode</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Full description (e.g. “NHS number”)&quot;</span>
    <span class="n">validator</span> <span class="o">=</span> <span class="n">Length</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ID_DESCRIPTOR_MAX_LEN</span><span class="p">)</span></div>


<div class="viewcode-block" id="IdDefinitionShortDescriptionNode"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.IdDefinitionShortDescriptionNode">[docs]</a><span class="k">class</span> <span class="nc">IdDefinitionShortDescriptionNode</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Short description (e.g. “NHS#”)&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;Try to keep it very short!&quot;</span>
    <span class="n">validator</span> <span class="o">=</span> <span class="n">Length</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ID_DESCRIPTOR_MAX_LEN</span><span class="p">)</span></div>


<div class="viewcode-block" id="Hl7AssigningAuthorityNode"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.Hl7AssigningAuthorityNode">[docs]</a><span class="k">class</span> <span class="nc">Hl7AssigningAuthorityNode</span><span class="p">(</span><span class="n">OptionalStringNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;HL7 Assigning Authority&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;For HL7 messaging: &quot;</span>
        <span class="s2">&quot;HL7 Assigning Authority for ID number (unique name of the &quot;</span>
        <span class="s2">&quot;system/organization/agency/department that creates the data).&quot;</span>
    <span class="p">)</span>
    <span class="n">validator</span> <span class="o">=</span> <span class="n">Length</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">HL7_AA_MAX_LEN</span><span class="p">)</span></div>


<div class="viewcode-block" id="Hl7IdTypeNode"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.Hl7IdTypeNode">[docs]</a><span class="k">class</span> <span class="nc">Hl7IdTypeNode</span><span class="p">(</span><span class="n">OptionalStringNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;HL7 Identifier Type&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;For HL7 messaging: &quot;</span>
        <span class="s2">&quot;HL7 Identifier Type code: &#39;a code corresponding to the type &quot;</span>
        <span class="s2">&quot;of identifier. In some cases, this code may be used as a &quot;</span>
        <span class="s2">&quot;qualifier to the </span><span class="se">\&quot;</span><span class="s2">Assigning Authority</span><span class="se">\&quot;</span><span class="s2"> component.&#39;&quot;</span>
    <span class="p">)</span>
    <span class="n">validator</span> <span class="o">=</span> <span class="n">Length</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">HL7_ID_TYPE_MAX_LEN</span><span class="p">)</span></div>


<div class="viewcode-block" id="HardWorkConfirmationSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.HardWorkConfirmationSchema">[docs]</a><span class="k">class</span> <span class="nc">HardWorkConfirmationSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">confirm_1_t</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Really?&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">confirm_2_t</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Leave ticked to confirm&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">confirm_3_f</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Please untick to confirm&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">confirm_4_t</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Be really sure; tick here also to &quot;</span>
                                    <span class="s2">&quot;confirm&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># noinspection PyMethodMayBeStatic</span>
    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">((</span><span class="ow">not</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;confirm_1_t&#39;</span><span class="p">])</span> <span class="ow">or</span>
                <span class="p">(</span><span class="ow">not</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;confirm_2_t&#39;</span><span class="p">])</span> <span class="ow">or</span>
                <span class="n">value</span><span class="p">[</span><span class="s1">&#39;confirm_3_f&#39;</span><span class="p">]</span> <span class="ow">or</span>
                <span class="p">(</span><span class="ow">not</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;confirm_4_t&#39;</span><span class="p">])):</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;Not fully confirmed&quot;</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># Login</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="LoginSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.LoginSchema">[docs]</a><span class="k">class</span> <span class="nc">LoginSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">UsernameNode</span><span class="p">()</span>  <span class="c1"># name must match ViewParam.USERNAME</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">SchemaNode</span><span class="p">(</span>  <span class="c1"># name must match ViewParam.PASSWORD</span>
        <span class="n">String</span><span class="p">(),</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">PasswordWidget</span><span class="p">(),</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Password&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">redirect_url</span> <span class="o">=</span> <span class="n">HiddenStringNode</span><span class="p">()</span>  <span class="c1"># name must match ViewParam.REDIRECT_URL</span></div>


<div class="viewcode-block" id="LoginForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.LoginForm">[docs]</a><span class="k">class</span> <span class="nc">LoginForm</span><span class="p">(</span><span class="n">InformativeForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span>
                 <span class="n">autocomplete_password</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">LoginSchema</span><span class="p">()</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">schema</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="p">[</span><span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">SUBMIT</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Log in&quot;</span><span class="p">)],</span>
            <span class="n">autocomplete</span><span class="o">=</span><span class="n">autocomplete_password</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>
        <span class="c1"># Suboptimal: autocomplete_password is not applied to the password</span>
        <span class="c1"># widget, just to the form; see</span>
        <span class="c1"># http://stackoverflow.com/questions/2530</span>
        <span class="c1"># Note that e.g. Chrome may ignore this.</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># Change password</span>
<span class="c1"># =============================================================================</span>

<span class="n">CHANGE_PASSWORD_TITLE</span> <span class="o">=</span> <span class="s2">&quot;Change password&quot;</span>


<div class="viewcode-block" id="OldUserPasswordCheck"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OldUserPasswordCheck">[docs]</a><span class="k">class</span> <span class="nc">OldUserPasswordCheck</span><span class="p">(</span><span class="n">SchemaNode</span><span class="p">):</span>
    <span class="n">schema_type</span> <span class="o">=</span> <span class="n">String</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Old password&quot;</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">PasswordWidget</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span>
        <span class="k">assert</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_password_valid</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;Old password incorrect&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ChangeOwnPasswordSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ChangeOwnPasswordSchema">[docs]</a><span class="k">class</span> <span class="nc">ChangeOwnPasswordSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">old_password</span> <span class="o">=</span> <span class="n">OldUserPasswordCheck</span><span class="p">()</span>
    <span class="n">new_password</span> <span class="o">=</span> <span class="n">NewPasswordNode</span><span class="p">()</span>  <span class="c1"># name must match ViewParam.NEW_PASSWORD</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">must_differ</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">must_differ</span> <span class="o">=</span> <span class="n">must_differ</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">must_differ</span> <span class="ow">and</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;new_password&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">[</span><span class="s1">&#39;old_password&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;New password must differ from old&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ChangeOwnPasswordForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ChangeOwnPasswordForm">[docs]</a><span class="k">class</span> <span class="nc">ChangeOwnPasswordForm</span><span class="p">(</span><span class="n">InformativeForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span>
                 <span class="n">must_differ</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">ChangeOwnPasswordSchema</span><span class="p">(</span><span class="n">must_differ</span><span class="o">=</span><span class="n">must_differ</span><span class="p">)</span><span class="o">.</span>\
            <span class="n">bind</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">schema</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="p">[</span><span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">SUBMIT</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="n">CHANGE_PASSWORD_TITLE</span><span class="p">)],</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ChangeOtherPasswordSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ChangeOtherPasswordSchema">[docs]</a><span class="k">class</span> <span class="nc">ChangeOtherPasswordSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">HiddenIntegerNode</span><span class="p">()</span>  <span class="c1"># name must match ViewParam.USER_ID</span>
    <span class="n">must_change_password</span> <span class="o">=</span> <span class="n">MustChangePasswordNode</span><span class="p">()</span>  <span class="c1"># match ViewParam.MUST_CHANGE_PASSWORD  # noqa</span>
    <span class="n">new_password</span> <span class="o">=</span> <span class="n">NewPasswordNode</span><span class="p">()</span>  <span class="c1"># name must match ViewParam.NEW_PASSWORD</span></div>


<div class="viewcode-block" id="ChangeOtherPasswordForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ChangeOtherPasswordForm">[docs]</a><span class="k">class</span> <span class="nc">ChangeOtherPasswordForm</span><span class="p">(</span><span class="n">SimpleSubmitForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">ChangeOtherPasswordSchema</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="n">CHANGE_PASSWORD_TITLE</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># Offer/agree terms</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="OfferTermsSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OfferTermsSchema">[docs]</a><span class="k">class</span> <span class="nc">OfferTermsSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="OfferTermsForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OfferTermsForm">[docs]</a><span class="k">class</span> <span class="nc">OfferTermsForm</span><span class="p">(</span><span class="n">SimpleSubmitForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span>
                 <span class="n">agree_button_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">OfferTermsSchema</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="n">agree_button_text</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># View audit trail</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="AuditTrailSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AuditTrailSchema">[docs]</a><span class="k">class</span> <span class="nc">AuditTrailSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">rows_per_page</span> <span class="o">=</span> <span class="n">RowsPerPageSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.ROWS_PER_PAGE</span>
    <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">StartPendulumSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.START_DATETIME  # noqa</span>
    <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">EndPendulumSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.END_DATETIME</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">OptionalStringNode</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Source (e.g. webviewer, tablet, console)&quot;</span><span class="p">)</span>  <span class="c1"># must match ViewParam.SOURCE  # noqa</span>
    <span class="n">remote_ip_addr</span> <span class="o">=</span> <span class="n">OptionalStringNode</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Remote IP address&quot;</span><span class="p">)</span>  <span class="c1"># must match ViewParam.REMOTE_IP_ADDR  # noqa</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">OptionalUserNameSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.USERNAME  # noqa</span>
    <span class="n">table_name</span> <span class="o">=</span> <span class="n">OptionalSingleTaskSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.TABLENAME  # noqa</span>
    <span class="n">server_pk</span> <span class="o">=</span> <span class="n">ServerPkSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.SERVER_PK</span>
    <span class="n">truncate</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span>  <span class="c1"># must match ViewParam.TRUNCATE</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Truncate details for easy viewing&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="AuditTrailForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AuditTrailForm">[docs]</a><span class="k">class</span> <span class="nc">AuditTrailForm</span><span class="p">(</span><span class="n">SimpleSubmitForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">AuditTrailSchema</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;View audit trail&quot;</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># View HL7 message log</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="HL7MessageLogSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.HL7MessageLogSchema">[docs]</a><span class="k">class</span> <span class="nc">HL7MessageLogSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">rows_per_page</span> <span class="o">=</span> <span class="n">RowsPerPageSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.ROWS_PER_PAGE</span>
    <span class="n">table_name</span> <span class="o">=</span> <span class="n">OptionalSingleTaskSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.TABLENAME  # noqa</span>
    <span class="n">server_pk</span> <span class="o">=</span> <span class="n">ServerPkSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.SERVER_PK</span>
    <span class="n">hl7_run_id</span> <span class="o">=</span> <span class="n">OptionalIntNode</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Run ID&quot;</span><span class="p">)</span>  <span class="c1"># must match ViewParam.HL7_RUN_ID  # noqa</span>
    <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">StartPendulumSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.START_DATETIME  # noqa</span>
    <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">EndPendulumSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.END_DATETIME</span></div>


<div class="viewcode-block" id="HL7MessageLogForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.HL7MessageLogForm">[docs]</a><span class="k">class</span> <span class="nc">HL7MessageLogForm</span><span class="p">(</span><span class="n">SimpleSubmitForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">HL7MessageLogSchema</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;View HL7 message log&quot;</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># View HL7 run log</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="HL7RunLogSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.HL7RunLogSchema">[docs]</a><span class="k">class</span> <span class="nc">HL7RunLogSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">rows_per_page</span> <span class="o">=</span> <span class="n">RowsPerPageSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.ROWS_PER_PAGE</span>
    <span class="n">hl7_run_id</span> <span class="o">=</span> <span class="n">OptionalIntNode</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Run ID&quot;</span><span class="p">)</span>  <span class="c1"># must match ViewParam.HL7_RUN_ID  # noqa</span>
    <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">StartPendulumSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.START_DATETIME  # noqa</span>
    <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">EndPendulumSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.END_DATETIME</span></div>


<div class="viewcode-block" id="HL7RunLogForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.HL7RunLogForm">[docs]</a><span class="k">class</span> <span class="nc">HL7RunLogForm</span><span class="p">(</span><span class="n">SimpleSubmitForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">HL7RunLogSchema</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;View HL7 run log&quot;</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># Task filters</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="EditTaskFilterWhoSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditTaskFilterWhoSchema">[docs]</a><span class="k">class</span> <span class="nc">EditTaskFilterWhoSchema</span><span class="p">(</span><span class="n">Schema</span><span class="p">):</span>
    <span class="n">surname</span> <span class="o">=</span> <span class="n">OptionalStringNode</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Surname&quot;</span><span class="p">)</span>  <span class="c1"># must match ViewParam.SURNAME  # noqa</span>
    <span class="n">forename</span> <span class="o">=</span> <span class="n">OptionalStringNode</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Forename&quot;</span><span class="p">)</span>  <span class="c1"># must match ViewParam.FORENAME  # noqa</span>
    <span class="n">dob</span> <span class="o">=</span> <span class="n">SchemaNode</span><span class="p">(</span>  <span class="c1"># must match ViewParam.DOB</span>
        <span class="n">Date</span><span class="p">(),</span>
        <span class="n">missing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Date of birth&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sex</span> <span class="o">=</span> <span class="n">OptionalSexSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.SEX</span>
    <span class="n">id_references</span> <span class="o">=</span> <span class="n">IdNumSequenceAnyCombination</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="n">OR_JOIN_DESCRIPTION</span><span class="p">)</span>  <span class="c1"># must match ViewParam.ID_REFERENCES  # noqa</span></div>


<div class="viewcode-block" id="EditTaskFilterWhenSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditTaskFilterWhenSchema">[docs]</a><span class="k">class</span> <span class="nc">EditTaskFilterWhenSchema</span><span class="p">(</span><span class="n">Schema</span><span class="p">):</span>
    <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">StartPendulumSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.START_DATETIME  # noqa</span>
    <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">EndPendulumSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.END_DATETIME</span></div>


<div class="viewcode-block" id="EditTaskFilterWhatSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditTaskFilterWhatSchema">[docs]</a><span class="k">class</span> <span class="nc">EditTaskFilterWhatSchema</span><span class="p">(</span><span class="n">Schema</span><span class="p">):</span>
    <span class="n">text_contents</span> <span class="o">=</span> <span class="n">TextContentsSequence</span><span class="p">()</span>  <span class="c1"># must match ViewParam.TEXT_CONTENTS  # noqa</span>
    <span class="n">complete_only</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span>  <span class="c1"># must match ViewParam.COMPLETE_ONLY</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Only completed tasks?&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="n">MultiTaskSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.TASKS</span></div>


<div class="viewcode-block" id="EditTaskFilterAdminSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditTaskFilterAdminSchema">[docs]</a><span class="k">class</span> <span class="nc">EditTaskFilterAdminSchema</span><span class="p">(</span><span class="n">Schema</span><span class="p">):</span>
    <span class="n">device_ids</span> <span class="o">=</span> <span class="n">DevicesSequence</span><span class="p">()</span>  <span class="c1"># must match ViewParam.DEVICE_IDS</span>
    <span class="n">user_ids</span> <span class="o">=</span> <span class="n">UploadingUserSequence</span><span class="p">()</span>  <span class="c1"># must match ViewParam.USER_IDS</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="n">AllowedGroupsSequence</span><span class="p">()</span>  <span class="c1"># must match ViewParam.GROUP_IDS</span></div>


<div class="viewcode-block" id="EditTaskFilterSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditTaskFilterSchema">[docs]</a><span class="k">class</span> <span class="nc">EditTaskFilterSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">who</span> <span class="o">=</span> <span class="n">EditTaskFilterWhoSchema</span><span class="p">(</span>  <span class="c1"># must match ViewParam.WHO</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Who&quot;</span><span class="p">,</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">MappingWidget</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="s2">&quot;mapping_accordion&quot;</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">what</span> <span class="o">=</span> <span class="n">EditTaskFilterWhatSchema</span><span class="p">(</span>  <span class="c1"># must match ViewParam.WHAT</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;What&quot;</span><span class="p">,</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">MappingWidget</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="s2">&quot;mapping_accordion&quot;</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">when</span> <span class="o">=</span> <span class="n">EditTaskFilterWhenSchema</span><span class="p">(</span>  <span class="c1"># must match ViewParam.WHEN</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;When&quot;</span><span class="p">,</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">MappingWidget</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="s2">&quot;mapping_accordion&quot;</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">admin</span> <span class="o">=</span> <span class="n">EditTaskFilterAdminSchema</span><span class="p">(</span>  <span class="c1"># must match ViewParam.ADMIN</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Administrative criteria&quot;</span><span class="p">,</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">MappingWidget</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="s2">&quot;mapping_accordion&quot;</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># noinspection PyUnusedLocal</span>
    <span class="k">def</span> <span class="nf">after_bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">kw</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># log.critical(&quot;EditTaskFilterSchema.after_bind&quot;)</span>
        <span class="c1"># log.critical(&quot;{!r}&quot;, self.__dict__)</span>
        <span class="c1"># This is pretty nasty. By the time we get here, the Form class has</span>
        <span class="c1"># made Field objects, and, I think, called a clone() function on us.</span>
        <span class="c1"># Objects like &quot;who&quot; are not in our __dict__ any more. Our __dict__</span>
        <span class="c1"># looks like:</span>
        <span class="c1">#   {</span>
        <span class="c1">#       &#39;typ&#39;: &lt;colander.Mapping object at 0x7fd7989b18d0&gt;,</span>
        <span class="c1">#       &#39;bindings&#39;: {</span>
        <span class="c1">#           &#39;open_who&#39;: True,</span>
        <span class="c1">#           &#39;open_when&#39;: True,</span>
        <span class="c1">#           &#39;request&#39;: ...,</span>
        <span class="c1">#       },</span>
        <span class="c1">#       &#39;_order&#39;: 118,</span>
        <span class="c1">#       &#39;children&#39;: [</span>
        <span class="c1">#           &lt;...CSRFToken object at ... (named csrf)&gt;,</span>
        <span class="c1">#           &lt;...EditTaskFilterWhoSchema object at ... (named who)&gt;,</span>
        <span class="c1">#           ...</span>
        <span class="c1">#       ],</span>
        <span class="c1">#       &#39;title&#39;: &#39;&#39;</span>
        <span class="c1">#   }</span>
        <span class="n">who</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;who&#39;</span><span class="p">)</span>
        <span class="n">what</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;what&#39;</span><span class="p">)</span>
        <span class="n">when</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;when&#39;</span><span class="p">)</span>
        <span class="n">admin</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;admin&#39;</span><span class="p">)</span>
        <span class="c1"># log.critical(&quot;who = {!r}&quot;, who)</span>
        <span class="c1"># log.critical(&quot;who.__dict__ = {!r}&quot;, who.__dict__)</span>
        <span class="n">who</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">OPEN_WHO</span><span class="p">]</span>
        <span class="n">what</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">OPEN_WHAT</span><span class="p">]</span>
        <span class="n">when</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">OPEN_WHEN</span><span class="p">]</span>
        <span class="n">admin</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">OPEN_ADMIN</span><span class="p">]</span></div>


<div class="viewcode-block" id="EditTaskFilterForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditTaskFilterForm">[docs]</a><span class="k">class</span> <span class="nc">EditTaskFilterForm</span><span class="p">(</span><span class="n">InformativeForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span>
                 <span class="n">open_who</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">open_what</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">open_when</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">open_admin</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">EditTaskFilterSchema</span><span class="p">()</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
                                             <span class="n">open_admin</span><span class="o">=</span><span class="n">open_admin</span><span class="p">,</span>
                                             <span class="n">open_what</span><span class="o">=</span><span class="n">open_what</span><span class="p">,</span>
                                             <span class="n">open_when</span><span class="o">=</span><span class="n">open_when</span><span class="p">,</span>
                                             <span class="n">open_who</span><span class="o">=</span><span class="n">open_who</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">schema</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="p">[</span><span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">SET_FILTERS</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Set filters&quot;</span><span class="p">),</span>
                     <span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">CLEAR_FILTERS</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Clear&quot;</span><span class="p">)],</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TasksPerPageSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.TasksPerPageSchema">[docs]</a><span class="k">class</span> <span class="nc">TasksPerPageSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">rows_per_page</span> <span class="o">=</span> <span class="n">RowsPerPageSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.ROWS_PER_PAGE</span></div>


<div class="viewcode-block" id="TasksPerPageForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.TasksPerPageForm">[docs]</a><span class="k">class</span> <span class="nc">TasksPerPageForm</span><span class="p">(</span><span class="n">InformativeForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">TasksPerPageSchema</span><span class="p">()</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">schema</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="p">[</span><span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">SUBMIT_TASKS_PER_PAGE</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Set n/page&quot;</span><span class="p">)],</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="RefreshTasksSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.RefreshTasksSchema">[docs]</a><span class="k">class</span> <span class="nc">RefreshTasksSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="RefreshTasksForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.RefreshTasksForm">[docs]</a><span class="k">class</span> <span class="nc">RefreshTasksForm</span><span class="p">(</span><span class="n">InformativeForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">RefreshTasksSchema</span><span class="p">()</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">schema</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="p">[</span><span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">REFRESH_TASKS</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Refresh&quot;</span><span class="p">)],</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># Trackers</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="ChooseTrackerSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ChooseTrackerSchema">[docs]</a><span class="k">class</span> <span class="nc">ChooseTrackerSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">which_idnum</span> <span class="o">=</span> <span class="n">MandatoryWhichIdNumSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.WHICH_IDNUM  # noqa</span>
    <span class="n">idnum_value</span> <span class="o">=</span> <span class="n">MandatoryIdNumValue</span><span class="p">()</span>  <span class="c1"># must match ViewParam.IDNUM_VALUE  # noqa</span>
    <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">StartPendulumSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.START_DATETIME  # noqa</span>
    <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">EndPendulumSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.END_DATETIME</span>
    <span class="n">all_tasks</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span>  <span class="c1"># match ViewParam.ALL_TASKS</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Use all eligible task types?&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="n">MultiTaskSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.TASKS</span>
    <span class="c1"># tracker_tasks_only will be set via the binding</span>
    <span class="n">viewtype</span> <span class="o">=</span> <span class="n">TaskTrackerOutputTypeSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParams.VIEWTYPE  # noqa</span></div>


<div class="viewcode-block" id="ChooseTrackerForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ChooseTrackerForm">[docs]</a><span class="k">class</span> <span class="nc">ChooseTrackerForm</span><span class="p">(</span><span class="n">InformativeForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span>
                 <span class="n">as_ctv</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">ChooseTrackerSchema</span><span class="p">()</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
                                            <span class="n">tracker_tasks_only</span><span class="o">=</span><span class="ow">not</span> <span class="n">as_ctv</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">schema</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="p">[</span><span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">SUBMIT</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;View CTV&quot;</span> <span class="k">if</span> <span class="n">as_ctv</span> <span class="k">else</span> <span class="s2">&quot;View tracker&quot;</span><span class="p">))],</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># Reports, which use dynamically created forms</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="ReportParamSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ReportParamSchema">[docs]</a><span class="k">class</span> <span class="nc">ReportParamSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">viewtype</span> <span class="o">=</span> <span class="n">ReportOutputTypeSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.VIEWTYPE</span>
    <span class="n">report_id</span> <span class="o">=</span> <span class="n">HiddenStringNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.REPORT_ID</span></div>
    <span class="c1"># Specific forms may inherit from this.</span>


<div class="viewcode-block" id="ReportParamForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ReportParamForm">[docs]</a><span class="k">class</span> <span class="nc">ReportParamForm</span><span class="p">(</span><span class="n">SimpleSubmitForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span>
                 <span class="n">schema_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">ReportParamSchema</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">schema_class</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;View report&quot;</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># View DDL</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="ViewDdlSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ViewDdlSchema">[docs]</a><span class="k">class</span> <span class="nc">ViewDdlSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">dialect</span> <span class="o">=</span> <span class="n">DatabaseDialectSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.DIALECT</span></div>


<div class="viewcode-block" id="ViewDdlForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ViewDdlForm">[docs]</a><span class="k">class</span> <span class="nc">ViewDdlForm</span><span class="p">(</span><span class="n">SimpleSubmitForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">ViewDdlSchema</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;View DDL&quot;</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># Add/edit/delete users</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="UserGroupMembershipGroupAdminSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.UserGroupMembershipGroupAdminSchema">[docs]</a><span class="k">class</span> <span class="nc">UserGroupMembershipGroupAdminSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Edit group membership - for group administrators.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">may_upload</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span>  <span class="c1"># match ViewParam.MAY_UPLOAD and User attribute</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Permitted to upload from a tablet/device&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">may_register_devices</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span>  <span class="c1"># match ViewParam.MAY_REGISTER_DEVICES and User attribute  # noqa</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Permitted to register tablet/client devices&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">may_use_webviewer</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span>  <span class="c1"># match ViewParam.MAY_USE_WEBVIEWER and User attribute  # noqa</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;May log in to web front end&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">view_all_patients_when_unfiltered</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span>  <span class="c1"># match ViewParam.VIEW_ALL_PATIENTS_WHEN_UNFILTERED and User attribute  # noqa</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;May view (browse) records from all patients when no patient &quot;</span>
              <span class="s2">&quot;filter set&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">may_dump_data</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span>  <span class="c1"># match ViewParam.MAY_DUMP_DATA and User attribute  # noqa</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;May perform bulk data dumps&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">may_run_reports</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span>  <span class="c1"># match ViewParam.MAY_RUN_REPORTS and User attribute  # noqa</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;May run reports&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">may_add_notes</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span>  <span class="c1"># match ViewParam.MAY_ADD_NOTES and User attribute  # noqa</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;May add special notes to tasks&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="UserGroupMembershipFullSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.UserGroupMembershipFullSchema">[docs]</a><span class="k">class</span> <span class="nc">UserGroupMembershipFullSchema</span><span class="p">(</span><span class="n">UserGroupMembershipGroupAdminSchema</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Edit group membership - for superusers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">groupadmin</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span>  <span class="c1"># match ViewParam.GROUPADMIN and User attribute  # noqa</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;User is a privileged group administrator for this group&quot;</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="EditUserGroupAdminSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditUserGroupAdminSchema">[docs]</a><span class="k">class</span> <span class="nc">EditUserGroupAdminSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">UsernameNode</span><span class="p">()</span>  <span class="c1"># name must match ViewParam.USERNAME and User attribute  # noqa</span>
    <span class="n">fullname</span> <span class="o">=</span> <span class="n">OptionalStringNode</span><span class="p">(</span>  <span class="c1"># name must match ViewParam.FULLNAME and User attribute  # noqa</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Full name&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">FULLNAME_MAX_LEN</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">OptionalStringNode</span><span class="p">(</span>  <span class="c1"># name must match ViewParam.EMAIL and User attribute  # noqa</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">EmailValidatorWithLengthConstraint</span><span class="p">(),</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;E-mail address&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">must_change_password</span> <span class="o">=</span> <span class="n">MustChangePasswordNode</span><span class="p">()</span>  <span class="c1"># match ViewParam.MUST_CHANGE_PASSWORD and User attribute  # noqa</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="n">AdministeredGroupsSequence</span><span class="p">()</span>  <span class="c1"># must match ViewParam.GROUP_IDS</span></div>


<div class="viewcode-block" id="EditUserFullSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditUserFullSchema">[docs]</a><span class="k">class</span> <span class="nc">EditUserFullSchema</span><span class="p">(</span><span class="n">EditUserGroupAdminSchema</span><span class="p">):</span>
    <span class="n">superuser</span> <span class="o">=</span> <span class="n">BooleanNode</span><span class="p">(</span>  <span class="c1"># match ViewParam.SUPERUSER and User attribute  # noqa</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Superuser (CAUTION!)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="n">AllGroupsSequence</span><span class="p">()</span>  <span class="c1"># must match ViewParam.GROUP_IDS</span></div>


<div class="viewcode-block" id="EditUserFullForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditUserFullForm">[docs]</a><span class="k">class</span> <span class="nc">EditUserFullForm</span><span class="p">(</span><span class="n">ApplyCancelForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">EditUserFullSchema</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="EditUserGroupAdminForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditUserGroupAdminForm">[docs]</a><span class="k">class</span> <span class="nc">EditUserGroupAdminForm</span><span class="p">(</span><span class="n">ApplyCancelForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">EditUserGroupAdminSchema</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="EditUserGroupMembershipFullForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditUserGroupMembershipFullForm">[docs]</a><span class="k">class</span> <span class="nc">EditUserGroupMembershipFullForm</span><span class="p">(</span><span class="n">ApplyCancelForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">UserGroupMembershipFullSchema</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="EditUserGroupMembershipGroupAdminForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditUserGroupMembershipGroupAdminForm">[docs]</a><span class="k">class</span> <span class="nc">EditUserGroupMembershipGroupAdminForm</span><span class="p">(</span><span class="n">ApplyCancelForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">UserGroupMembershipGroupAdminSchema</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="AddUserSuperuserSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AddUserSuperuserSchema">[docs]</a><span class="k">class</span> <span class="nc">AddUserSuperuserSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">UsernameNode</span><span class="p">()</span>  <span class="c1"># name must match ViewParam.USERNAME and User attribute  # noqa</span>
    <span class="n">new_password</span> <span class="o">=</span> <span class="n">NewPasswordNode</span><span class="p">()</span>  <span class="c1"># name must match ViewParam.NEW_PASSWORD</span>
    <span class="n">must_change_password</span> <span class="o">=</span> <span class="n">MustChangePasswordNode</span><span class="p">()</span>  <span class="c1"># match ViewParam.MUST_CHANGE_PASSWORD and User attribute  # noqa</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="n">AllGroupsSequence</span><span class="p">()</span>  <span class="c1"># must match ViewParam.GROUP_IDS</span></div>


<div class="viewcode-block" id="AddUserGroupadminSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AddUserGroupadminSchema">[docs]</a><span class="k">class</span> <span class="nc">AddUserGroupadminSchema</span><span class="p">(</span><span class="n">AddUserSuperuserSchema</span><span class="p">):</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="n">AdministeredGroupsSequence</span><span class="p">()</span>  <span class="c1"># must match ViewParam.GROUP_IDS</span></div>


<div class="viewcode-block" id="AddUserSuperuserForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AddUserSuperuserForm">[docs]</a><span class="k">class</span> <span class="nc">AddUserSuperuserForm</span><span class="p">(</span><span class="n">AddCancelForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">AddUserSuperuserSchema</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="AddUserGroupadminForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AddUserGroupadminForm">[docs]</a><span class="k">class</span> <span class="nc">AddUserGroupadminForm</span><span class="p">(</span><span class="n">AddCancelForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">AddUserGroupadminSchema</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="SetUserUploadGroupSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.SetUserUploadGroupSchema">[docs]</a><span class="k">class</span> <span class="nc">SetUserUploadGroupSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">upload_group_id</span> <span class="o">=</span> <span class="n">OptionalGroupIdSelectorUserGroups</span><span class="p">(</span>  <span class="c1"># must match ViewParam.UPLOAD_GROUP_ID  # noqa</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Group into which to upload data&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Pick a group from those to which the user belongs&quot;</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="SetUserUploadGroupForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.SetUserUploadGroupForm">[docs]</a><span class="k">class</span> <span class="nc">SetUserUploadGroupForm</span><span class="p">(</span><span class="n">InformativeForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="s2">&quot;User&quot;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">SetUserUploadGroupSchema</span><span class="p">()</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
                                                 <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>  <span class="c1"># UNUSUAL</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">schema</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="p">[</span>
                <span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">SUBMIT</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Set&quot;</span><span class="p">),</span>
                <span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cancel&quot;</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="DeleteUserSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.DeleteUserSchema">[docs]</a><span class="k">class</span> <span class="nc">DeleteUserSchema</span><span class="p">(</span><span class="n">HardWorkConfirmationSchema</span><span class="p">):</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">HiddenIntegerNode</span><span class="p">()</span>  <span class="c1"># name must match ViewParam.USER_ID</span>
    <span class="n">danger</span> <span class="o">=</span> <span class="n">ValidateDangerousOperationNode</span><span class="p">()</span></div>


<div class="viewcode-block" id="DeleteUserForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.DeleteUserForm">[docs]</a><span class="k">class</span> <span class="nc">DeleteUserForm</span><span class="p">(</span><span class="n">DeleteCancelForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">DeleteUserSchema</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># Add/edit/delete groups</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="EditGroupSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditGroupSchema">[docs]</a><span class="k">class</span> <span class="nc">EditGroupSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">group_id</span> <span class="o">=</span> <span class="n">HiddenIntegerNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.GROUP_ID</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">SchemaNode</span><span class="p">(</span>  <span class="c1"># must match ViewParam.NAME</span>
        <span class="n">String</span><span class="p">(),</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Group name&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">GROUP_NAME_MAX_LEN</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">MandatoryStringNode</span><span class="p">(</span>  <span class="c1"># must match ViewParam.DESCRIPTION</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">GROUP_DESCRIPTION_MAX_LEN</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="n">AllOtherGroupsSequence</span><span class="p">(</span>  <span class="c1"># must match ViewParam.GROUP_IDS</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Other groups this group may see&quot;</span>
    <span class="p">)</span>
    <span class="n">upload_policy</span> <span class="o">=</span> <span class="n">PolicyNode</span><span class="p">(</span>  <span class="c1"># must match ViewParam.UPLOAD_POLICY</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Upload policy&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Minimum required patient information to copy data to &quot;</span>
                    <span class="s2">&quot;server&quot;</span>
    <span class="p">)</span>
    <span class="n">finalize_policy</span> <span class="o">=</span> <span class="n">PolicyNode</span><span class="p">(</span>  <span class="c1"># must match ViewParam.FINALIZE_POLICY</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Finalize policy&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Minimum required patient information to clear data off &quot;</span>
                    <span class="s2">&quot;source device&quot;</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">CountStarSpecializedQuery</span><span class="p">(</span><span class="n">Group</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">req</span><span class="o">.</span><span class="n">dbsession</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Group</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">value</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">GROUP_ID</span><span class="p">])</span>\
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Group</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">value</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">NAME</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">count_star</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;Name is used by another group!&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="EditGroupForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditGroupForm">[docs]</a><span class="k">class</span> <span class="nc">EditGroupForm</span><span class="p">(</span><span class="n">InformativeForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="n">group</span><span class="p">:</span> <span class="n">Group</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">EditGroupSchema</span><span class="p">()</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
                                        <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">)</span>  <span class="c1"># UNUSUAL BINDING</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">schema</span><span class="p">,</span>
            <span class="n">buttons</span><span class="o">=</span><span class="p">[</span>
                <span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">SUBMIT</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Apply&quot;</span><span class="p">),</span>
                <span class="n">Button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Cancel&quot;</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="AddGroupSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AddGroupSchema">[docs]</a><span class="k">class</span> <span class="nc">AddGroupSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">SchemaNode</span><span class="p">(</span>  <span class="c1"># name must match ViewParam.NAME</span>
        <span class="n">String</span><span class="p">(),</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Group name&quot;</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">CountStarSpecializedQuery</span><span class="p">(</span><span class="n">Group</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">req</span><span class="o">.</span><span class="n">dbsession</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Group</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">value</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">NAME</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">count_star</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;Name is used by another group!&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="AddGroupForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AddGroupForm">[docs]</a><span class="k">class</span> <span class="nc">AddGroupForm</span><span class="p">(</span><span class="n">AddCancelForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">AddGroupSchema</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="DeleteGroupSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.DeleteGroupSchema">[docs]</a><span class="k">class</span> <span class="nc">DeleteGroupSchema</span><span class="p">(</span><span class="n">HardWorkConfirmationSchema</span><span class="p">):</span>
    <span class="n">group_id</span> <span class="o">=</span> <span class="n">HiddenIntegerNode</span><span class="p">()</span>  <span class="c1"># name must match ViewParam.GROUP_ID</span>
    <span class="n">danger</span> <span class="o">=</span> <span class="n">ValidateDangerousOperationNode</span><span class="p">()</span></div>


<div class="viewcode-block" id="DeleteGroupForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.DeleteGroupForm">[docs]</a><span class="k">class</span> <span class="nc">DeleteGroupForm</span><span class="p">(</span><span class="n">DeleteCancelForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">DeleteGroupSchema</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># Offer research dumps</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="OfferDumpManualSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OfferDumpManualSchema">[docs]</a><span class="k">class</span> <span class="nc">OfferDumpManualSchema</span><span class="p">(</span><span class="n">Schema</span><span class="p">):</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="n">AllowedGroupsSequence</span><span class="p">()</span>  <span class="c1"># must match ViewParam.GROUP_IDS</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="n">MultiTaskSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.TASKS</span>

    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Manual settings&quot;</span>
    <span class="n">widget</span> <span class="o">=</span> <span class="n">MappingWidget</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="s2">&quot;mapping_accordion&quot;</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="OfferBasicDumpSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OfferBasicDumpSchema">[docs]</a><span class="k">class</span> <span class="nc">OfferBasicDumpSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">dump_method</span> <span class="o">=</span> <span class="n">DumpTypeSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.DUMP_METHOD</span>
    <span class="n">sort</span> <span class="o">=</span> <span class="n">SortTsvByHeadingsNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.SORT</span>
    <span class="n">manual</span> <span class="o">=</span> <span class="n">OfferDumpManualSchema</span><span class="p">()</span>  <span class="c1"># must match ViewParam.MANUAL</span></div>


<div class="viewcode-block" id="OfferBasicDumpForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OfferBasicDumpForm">[docs]</a><span class="k">class</span> <span class="nc">OfferBasicDumpForm</span><span class="p">(</span><span class="n">SimpleSubmitForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">OfferBasicDumpSchema</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;Dump&quot;</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="OfferSqlDumpManualSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OfferSqlDumpManualSchema">[docs]</a><span class="k">class</span> <span class="nc">OfferSqlDumpManualSchema</span><span class="p">(</span><span class="n">Schema</span><span class="p">):</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="n">AllowedGroupsSequence</span><span class="p">()</span>  <span class="c1"># must match ViewParam.GROUP_IDS</span>
    <span class="n">tasks</span> <span class="o">=</span> <span class="n">MultiTaskSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.TASKS</span></div>


<div class="viewcode-block" id="OfferSqlDumpSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OfferSqlDumpSchema">[docs]</a><span class="k">class</span> <span class="nc">OfferSqlDumpSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">dump_method</span> <span class="o">=</span> <span class="n">DumpTypeSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.DUMP_METHOD</span>
    <span class="n">sqlite_method</span> <span class="o">=</span> <span class="n">SqliteSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.SQLITE_METHOD</span>
    <span class="n">include_blobs</span> <span class="o">=</span> <span class="n">IncludeBlobsNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.INCLUDE_BLOBS</span>
    <span class="n">manual</span> <span class="o">=</span> <span class="n">OfferDumpManualSchema</span><span class="p">()</span>  <span class="c1"># must match ViewParam.MANUAL</span></div>


<div class="viewcode-block" id="OfferSqlDumpForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.OfferSqlDumpForm">[docs]</a><span class="k">class</span> <span class="nc">OfferSqlDumpForm</span><span class="p">(</span><span class="n">SimpleSubmitForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">OfferSqlDumpSchema</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;Dump&quot;</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># Edit server settings</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="EditServerSettingsSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditServerSettingsSchema">[docs]</a><span class="k">class</span> <span class="nc">EditServerSettingsSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">database_title</span> <span class="o">=</span> <span class="n">SchemaNode</span><span class="p">(</span>  <span class="c1"># must match ViewParam.DATABASE_TITLE</span>
        <span class="n">String</span><span class="p">(),</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Database friendly title&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">Length</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">DATABASE_TITLE_MAX_LEN</span><span class="p">),</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="EditServerSettingsForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditServerSettingsForm">[docs]</a><span class="k">class</span> <span class="nc">EditServerSettingsForm</span><span class="p">(</span><span class="n">ApplyCancelForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">EditServerSettingsSchema</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="EditIdDefinitionSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditIdDefinitionSchema">[docs]</a><span class="k">class</span> <span class="nc">EditIdDefinitionSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">which_idnum</span> <span class="o">=</span> <span class="n">HiddenIntegerNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.WHICH_IDNUM</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">IdDefinitionDescriptionNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.DESCRIPTION  # noqa</span>
    <span class="n">short_description</span> <span class="o">=</span> <span class="n">IdDefinitionShortDescriptionNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.SHORT_DESCRIPTION  # noqa</span>
    <span class="n">hl7_id_type</span> <span class="o">=</span> <span class="n">Hl7IdTypeNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.HL7_ID_TYPE</span>
    <span class="n">hl7_assigning_authority</span> <span class="o">=</span> <span class="n">Hl7AssigningAuthorityNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.HL7_ASSIGNING_AUTHORITY  # noqa</span>

    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">qd</span> <span class="o">=</span> <span class="n">CountStarSpecializedQuery</span><span class="p">(</span><span class="n">IdNumDefinition</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">req</span><span class="o">.</span><span class="n">dbsession</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">IdNumDefinition</span><span class="o">.</span><span class="n">which_idnum</span> <span class="o">!=</span>
                    <span class="n">value</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">WHICH_IDNUM</span><span class="p">])</span>\
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">IdNumDefinition</span><span class="o">.</span><span class="n">description</span> <span class="o">==</span>
                    <span class="n">value</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">DESCRIPTION</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">qd</span><span class="o">.</span><span class="n">count_star</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;Description is used by another ID number!&quot;</span><span class="p">)</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">CountStarSpecializedQuery</span><span class="p">(</span><span class="n">IdNumDefinition</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">req</span><span class="o">.</span><span class="n">dbsession</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">IdNumDefinition</span><span class="o">.</span><span class="n">which_idnum</span> <span class="o">!=</span>
                    <span class="n">value</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">WHICH_IDNUM</span><span class="p">])</span>\
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">IdNumDefinition</span><span class="o">.</span><span class="n">short_description</span> <span class="o">==</span>
                    <span class="n">value</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">SHORT_DESCRIPTION</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">qs</span><span class="o">.</span><span class="n">count_star</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;Short description is used by another ID &quot;</span>
                                <span class="s2">&quot;number!&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="EditIdDefinitionForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditIdDefinitionForm">[docs]</a><span class="k">class</span> <span class="nc">EditIdDefinitionForm</span><span class="p">(</span><span class="n">ApplyCancelForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">EditIdDefinitionSchema</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="AddIdDefinitionSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AddIdDefinitionSchema">[docs]</a><span class="k">class</span> <span class="nc">AddIdDefinitionSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">which_idnum</span> <span class="o">=</span> <span class="n">SchemaNode</span><span class="p">(</span>  <span class="c1"># must match ViewParam.WHICH_IDNUM</span>
        <span class="n">Integer</span><span class="p">(),</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Which ID number?&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Specify the integer to represent the type of this ID &quot;</span>
                    <span class="s2">&quot;number class (e.g. consecutive numbering from 1)&quot;</span><span class="p">,</span>
        <span class="n">validator</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">IdDefinitionDescriptionNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.DESCRIPTION  # noqa</span>
    <span class="n">short_description</span> <span class="o">=</span> <span class="n">IdDefinitionShortDescriptionNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.SHORT_DESCRIPTION  # noqa</span>

    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">qw</span> <span class="o">=</span> <span class="n">CountStarSpecializedQuery</span><span class="p">(</span><span class="n">IdNumDefinition</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">req</span><span class="o">.</span><span class="n">dbsession</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">IdNumDefinition</span><span class="o">.</span><span class="n">which_idnum</span> <span class="o">==</span>
                    <span class="n">value</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">WHICH_IDNUM</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">qw</span><span class="o">.</span><span class="n">count_star</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;ID# clashes with another ID number!&quot;</span><span class="p">)</span>
        <span class="n">qd</span> <span class="o">=</span> <span class="n">CountStarSpecializedQuery</span><span class="p">(</span><span class="n">IdNumDefinition</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">req</span><span class="o">.</span><span class="n">dbsession</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">IdNumDefinition</span><span class="o">.</span><span class="n">description</span> <span class="o">==</span>
                    <span class="n">value</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">DESCRIPTION</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">qd</span><span class="o">.</span><span class="n">count_star</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;Description is used by another ID number!&quot;</span><span class="p">)</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">CountStarSpecializedQuery</span><span class="p">(</span><span class="n">IdNumDefinition</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">req</span><span class="o">.</span><span class="n">dbsession</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">IdNumDefinition</span><span class="o">.</span><span class="n">short_description</span> <span class="o">==</span>
                    <span class="n">value</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">SHORT_DESCRIPTION</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">qs</span><span class="o">.</span><span class="n">count_star</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s2">&quot;Short description is used by another ID &quot;</span>
                                <span class="s2">&quot;number!&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="AddIdDefinitionForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AddIdDefinitionForm">[docs]</a><span class="k">class</span> <span class="nc">AddIdDefinitionForm</span><span class="p">(</span><span class="n">AddCancelForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">AddIdDefinitionSchema</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="DeleteIdDefinitionSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.DeleteIdDefinitionSchema">[docs]</a><span class="k">class</span> <span class="nc">DeleteIdDefinitionSchema</span><span class="p">(</span><span class="n">HardWorkConfirmationSchema</span><span class="p">):</span>
    <span class="n">which_idnum</span> <span class="o">=</span> <span class="n">HiddenIntegerNode</span><span class="p">()</span>  <span class="c1"># name must match ViewParam.WHICH_IDNUM</span>
    <span class="n">danger</span> <span class="o">=</span> <span class="n">ValidateDangerousOperationNode</span><span class="p">()</span></div>


<div class="viewcode-block" id="DeleteIdDefinitionForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.DeleteIdDefinitionForm">[docs]</a><span class="k">class</span> <span class="nc">DeleteIdDefinitionForm</span><span class="p">(</span><span class="n">DangerousForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">DeleteIdDefinitionSchema</span><span class="p">,</span>
                         <span class="n">submit_action</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;Delete&quot;</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># Special notes</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="AddSpecialNoteSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AddSpecialNoteSchema">[docs]</a><span class="k">class</span> <span class="nc">AddSpecialNoteSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">table_name</span> <span class="o">=</span> <span class="n">HiddenStringNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.TABLENAME</span>
    <span class="n">server_pk</span> <span class="o">=</span> <span class="n">HiddenIntegerNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.SERVER_PK</span>
    <span class="n">note</span> <span class="o">=</span> <span class="n">MandatoryStringNode</span><span class="p">(</span>  <span class="c1"># must match ViewParam.NOTE</span>
        <span class="n">widget</span><span class="o">=</span><span class="n">TextAreaWidget</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">danger</span> <span class="o">=</span> <span class="n">ValidateDangerousOperationNode</span><span class="p">()</span></div>


<div class="viewcode-block" id="AddSpecialNoteForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.AddSpecialNoteForm">[docs]</a><span class="k">class</span> <span class="nc">AddSpecialNoteForm</span><span class="p">(</span><span class="n">DangerousForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">AddSpecialNoteSchema</span><span class="p">,</span>
                         <span class="n">submit_action</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">SUBMIT</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;Add&quot;</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># The unusual data manipulation operations</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="EraseTaskSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EraseTaskSchema">[docs]</a><span class="k">class</span> <span class="nc">EraseTaskSchema</span><span class="p">(</span><span class="n">HardWorkConfirmationSchema</span><span class="p">):</span>
    <span class="n">table_name</span> <span class="o">=</span> <span class="n">HiddenStringNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.TABLENAME</span>
    <span class="n">server_pk</span> <span class="o">=</span> <span class="n">HiddenIntegerNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.SERVER_PK</span>
    <span class="n">danger</span> <span class="o">=</span> <span class="n">ValidateDangerousOperationNode</span><span class="p">()</span></div>


<div class="viewcode-block" id="EraseTaskForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EraseTaskForm">[docs]</a><span class="k">class</span> <span class="nc">EraseTaskForm</span><span class="p">(</span><span class="n">DangerousForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">EraseTaskSchema</span><span class="p">,</span>
                         <span class="n">submit_action</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;Erase&quot;</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="DeletePatientChooseSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.DeletePatientChooseSchema">[docs]</a><span class="k">class</span> <span class="nc">DeletePatientChooseSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">which_idnum</span> <span class="o">=</span> <span class="n">MandatoryWhichIdNumSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.WHICH_IDNUM  # noqa</span>
    <span class="n">idnum_value</span> <span class="o">=</span> <span class="n">MandatoryIdNumValue</span><span class="p">()</span>  <span class="c1"># must match ViewParam.IDNUM_VALUE</span>
    <span class="n">group_id</span> <span class="o">=</span> <span class="n">MandatoryGroupIdSelectorAdministeredGroups</span><span class="p">()</span>  <span class="c1"># must match ViewParam.GROUP_ID  # noqa</span>
    <span class="n">danger</span> <span class="o">=</span> <span class="n">ValidateDangerousOperationNode</span><span class="p">()</span></div>


<div class="viewcode-block" id="DeletePatientChooseForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.DeletePatientChooseForm">[docs]</a><span class="k">class</span> <span class="nc">DeletePatientChooseForm</span><span class="p">(</span><span class="n">DangerousForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">DeletePatientChooseSchema</span><span class="p">,</span>
                         <span class="n">submit_action</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">SUBMIT</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;Show tasks that will be deleted&quot;</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="DeletePatientConfirmSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.DeletePatientConfirmSchema">[docs]</a><span class="k">class</span> <span class="nc">DeletePatientConfirmSchema</span><span class="p">(</span><span class="n">HardWorkConfirmationSchema</span><span class="p">):</span>
    <span class="n">which_idnum</span> <span class="o">=</span> <span class="n">HiddenIntegerNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.WHICH_IDNUM</span>
    <span class="n">idnum_value</span> <span class="o">=</span> <span class="n">HiddenIntegerNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.IDNUM_VALUE</span>
    <span class="n">group_id</span> <span class="o">=</span> <span class="n">HiddenIntegerNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.GROUP_ID</span>
    <span class="n">danger</span> <span class="o">=</span> <span class="n">ValidateDangerousOperationNode</span><span class="p">()</span></div>


<div class="viewcode-block" id="DeletePatientConfirmForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.DeletePatientConfirmForm">[docs]</a><span class="k">class</span> <span class="nc">DeletePatientConfirmForm</span><span class="p">(</span><span class="n">DangerousForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">DeletePatientConfirmSchema</span><span class="p">,</span>
                         <span class="n">submit_action</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;Delete&quot;</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="n">EDIT_PATIENT_SIMPLE_PARAMS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ViewParam</span><span class="o">.</span><span class="n">FORENAME</span><span class="p">,</span>
    <span class="n">ViewParam</span><span class="o">.</span><span class="n">SURNAME</span><span class="p">,</span>
    <span class="n">ViewParam</span><span class="o">.</span><span class="n">DOB</span><span class="p">,</span>
    <span class="n">ViewParam</span><span class="o">.</span><span class="n">SEX</span><span class="p">,</span>
    <span class="n">ViewParam</span><span class="o">.</span><span class="n">ADDRESS</span><span class="p">,</span>
    <span class="n">ViewParam</span><span class="o">.</span><span class="n">GP</span><span class="p">,</span>
    <span class="n">ViewParam</span><span class="o">.</span><span class="n">OTHER</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="EditPatientSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditPatientSchema">[docs]</a><span class="k">class</span> <span class="nc">EditPatientSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">server_pk</span> <span class="o">=</span> <span class="n">HiddenIntegerNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.SERVER_PK</span>
    <span class="n">group_id</span> <span class="o">=</span> <span class="n">HiddenIntegerNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.GROUP_ID</span>
    <span class="n">forename</span> <span class="o">=</span> <span class="n">OptionalStringNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.FORENAME</span>
    <span class="n">surname</span> <span class="o">=</span> <span class="n">OptionalStringNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.SURNAME</span>
    <span class="n">dob</span> <span class="o">=</span> <span class="n">DateSelectorNode</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Date of birth&quot;</span><span class="p">)</span>  <span class="c1"># must match ViewParam.DOB</span>
    <span class="n">sex</span> <span class="o">=</span> <span class="n">MandatorySexSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.SEX</span>
    <span class="n">address</span> <span class="o">=</span> <span class="n">OptionalStringNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.ADDRESS</span>
    <span class="n">gp</span> <span class="o">=</span> <span class="n">OptionalStringNode</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;GP&quot;</span><span class="p">)</span>  <span class="c1"># must match ViewParam.GP</span>
    <span class="n">other</span> <span class="o">=</span> <span class="n">OptionalStringNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.OTHER</span>
    <span class="n">id_references</span> <span class="o">=</span> <span class="n">IdNumSequenceUniquePerWhichIdnum</span><span class="p">()</span>  <span class="c1"># must match ViewParam.ID_REFERENCES  # noqa</span>
    <span class="n">danger</span> <span class="o">=</span> <span class="n">ValidateDangerousOperationNode</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">SchemaNode</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">req</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bindings</span><span class="p">[</span><span class="n">Binding</span><span class="o">.</span><span class="n">REQUEST</span><span class="p">]</span>  <span class="c1"># type: CamcopsRequest</span>
        <span class="n">dbsession</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">dbsession</span>
        <span class="n">group_id</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">GROUP_ID</span><span class="p">]</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">Group</span><span class="o">.</span><span class="n">get_group_by_id</span><span class="p">(</span><span class="n">dbsession</span><span class="p">,</span> <span class="n">group_id</span><span class="p">)</span>
        <span class="n">testpatient</span> <span class="o">=</span> <span class="n">Patient</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">EDIT_PATIENT_SIMPLE_PARAMS</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">testpatient</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">testpatient</span><span class="o">.</span><span class="n">idnums</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[PatientIdNum]</span>
        <span class="k">for</span> <span class="n">idrefdict</span> <span class="ow">in</span> <span class="n">value</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">ID_REFERENCES</span><span class="p">]:</span>
            <span class="n">pidnum</span> <span class="o">=</span> <span class="n">PatientIdNum</span><span class="p">()</span>
            <span class="n">pidnum</span><span class="o">.</span><span class="n">which_idnum</span> <span class="o">=</span> <span class="n">idrefdict</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">WHICH_IDNUM</span><span class="p">]</span>
            <span class="n">pidnum</span><span class="o">.</span><span class="n">idnum_value</span> <span class="o">=</span> <span class="n">idrefdict</span><span class="p">[</span><span class="n">ViewParam</span><span class="o">.</span><span class="n">IDNUM_VALUE</span><span class="p">]</span>
            <span class="n">testpatient</span><span class="o">.</span><span class="n">idnums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pidnum</span><span class="p">)</span>
        <span class="n">tk_finalize_policy</span> <span class="o">=</span> <span class="n">TokenizedPolicy</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">finalize_policy</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">testpatient</span><span class="o">.</span><span class="n">satisfies_id_policy</span><span class="p">(</span><span class="n">tk_finalize_policy</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">Invalid</span><span class="p">(</span>
                <span class="n">node</span><span class="p">,</span>
                <span class="s2">&quot;Patient would not meet &#39;finalize&#39; ID policy for group </span><span class="si">{}</span><span class="s2">! &quot;</span>
                <span class="s2">&quot;[That policy is: </span><span class="si">{!r}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">group</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">finalize_policy</span><span class="p">))</span></div>


<div class="viewcode-block" id="EditPatientForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.EditPatientForm">[docs]</a><span class="k">class</span> <span class="nc">EditPatientForm</span><span class="p">(</span><span class="n">DangerousForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">EditPatientSchema</span><span class="p">,</span>
                         <span class="n">submit_action</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">SUBMIT</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;Submit&quot;</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="ForciblyFinalizeChooseDeviceSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ForciblyFinalizeChooseDeviceSchema">[docs]</a><span class="k">class</span> <span class="nc">ForciblyFinalizeChooseDeviceSchema</span><span class="p">(</span><span class="n">CSRFSchema</span><span class="p">):</span>
    <span class="n">device_id</span> <span class="o">=</span> <span class="n">MandatoryDeviceIdSelector</span><span class="p">()</span>  <span class="c1"># must match ViewParam.DEVICE_ID</span>
    <span class="n">danger</span> <span class="o">=</span> <span class="n">ValidateDangerousOperationNode</span><span class="p">()</span></div>


<div class="viewcode-block" id="ForciblyFinalizeChooseDeviceForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ForciblyFinalizeChooseDeviceForm">[docs]</a><span class="k">class</span> <span class="nc">ForciblyFinalizeChooseDeviceForm</span><span class="p">(</span><span class="n">SimpleSubmitForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">ForciblyFinalizeChooseDeviceSchema</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;View affected tasks&quot;</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="ForciblyFinalizeConfirmSchema"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ForciblyFinalizeConfirmSchema">[docs]</a><span class="k">class</span> <span class="nc">ForciblyFinalizeConfirmSchema</span><span class="p">(</span><span class="n">HardWorkConfirmationSchema</span><span class="p">):</span>
    <span class="n">device_id</span> <span class="o">=</span> <span class="n">HiddenIntegerNode</span><span class="p">()</span>  <span class="c1"># must match ViewParam.DEVICE_ID</span>
    <span class="n">danger</span> <span class="o">=</span> <span class="n">ValidateDangerousOperationNode</span><span class="p">()</span></div>


<div class="viewcode-block" id="ForciblyFinalizeConfirmForm"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.ForciblyFinalizeConfirmForm">[docs]</a><span class="k">class</span> <span class="nc">ForciblyFinalizeConfirmForm</span><span class="p">(</span><span class="n">DangerousForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="s2">&quot;CamcopsRequest&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_class</span><span class="o">=</span><span class="n">ForciblyFinalizeConfirmSchema</span><span class="p">,</span>
                         <span class="n">submit_action</span><span class="o">=</span><span class="n">FormAction</span><span class="o">.</span><span class="n">FINALIZE</span><span class="p">,</span>
                         <span class="n">submit_title</span><span class="o">=</span><span class="s2">&quot;Forcibly finalize&quot;</span><span class="p">,</span>
                         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># Unit tests</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="SchemaTests"><a class="viewcode-back" href="../../../autodoc/cc_modules/cc_forms.html#camcops_server.cc_modules.cc_forms.SchemaTests">[docs]</a><span class="k">class</span> <span class="nc">SchemaTests</span><span class="p">(</span><span class="n">DemoRequestTestCase</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_serialize_deserialize</span><span class="p">(</span><span class="n">schema</span><span class="p">:</span> <span class="n">Schema</span><span class="p">,</span>
                               <span class="n">appstruct</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cstruct</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">appstruct</span><span class="p">)</span>
        <span class="n">final</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">cstruct</span><span class="p">)</span>
        <span class="n">mismatch</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">appstruct</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">final</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">mismatch</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">mismatch</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Elements of final don&#39;t match corresponding elements of starting &quot;</span>
            <span class="s2">&quot;appstruct:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;final = </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;start = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">pformat</span><span class="p">(</span><span class="n">final</span><span class="p">),</span> <span class="n">pformat</span><span class="p">(</span><span class="n">appstruct</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_login_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">announce</span><span class="p">(</span><span class="s2">&quot;test_login_schema&quot;</span><span class="p">)</span>  <span class="c1"># noqa</span>
        <span class="n">appstruct</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ViewParam</span><span class="o">.</span><span class="n">USERNAME</span><span class="p">:</span> <span class="s2">&quot;testuser&quot;</span><span class="p">,</span>
            <span class="n">ViewParam</span><span class="o">.</span><span class="n">PASSWORD</span><span class="p">:</span> <span class="s2">&quot;testpw&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">LoginSchema</span><span class="p">()</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">req</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_serialize_deserialize</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">appstruct</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1"># main</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># run with &quot;python -m camcops_server.cc_modules.forms -v&quot; to be verbose</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main_only_quicksetup_rootlogger</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../../index.html">Table Of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/download.html">2. Downloading CamCOPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../client/client_installation.html">3. Installing and configuring the client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../client/client_using.html">4. Using the client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../server/server_front_end_general.html">5. Web site: general use</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks/_tasks_by_category.html">6. Tasks in CamCOPS by category</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tasks/_tasks_all.html">7. All tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../client/client_troubleshooting.html">8. Troubleshooting client problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../server/server_installation.html">9. Installing CamCOPS on the server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../server/server_configuration.html">10. Configuring the server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../server/server_config_file.html">11. The CamCOPS server configuration file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../server/server_front_end_admin.html">12. Web site: admin functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../server/server_command_line.html">13. CamCOPS command-line tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../server/server_troubleshooting.html">14. Troubleshooting server problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../licences/licences.html">15. Licences</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/index.html">16. Developer notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/tcpip_ports.html">17. Common relevant TCP/IP ports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/linux_flavours.html">18. Linux flavours</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autodoc/_index.html">19. Automatic documentation of core server source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">20. Change log/history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../known_problems.html">21. Known problems: client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../known_problems.html#known-problems-server">22. Known problems: server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../to_do.html">23. Things to do</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../wishlist.html">24. Wishlist and blue-sky thoughts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/local_info.html">25. Local configuration information</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CamCOPS 2.2.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2018, Rudolf Cardinal.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>