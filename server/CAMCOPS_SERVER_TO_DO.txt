
*** filters as database entities
    - session has FK to current filter
    - filter says "suitable for tracker Y/N"
    - ?quick-tracker option (which_idnum, idnum_value) or current filter
    - "groups" as part of filter (one, many...)
    - fully flexible task list as part of filter
    - LATER option for more flexible things

*** delete patient
*** forcibly preserve

*** database upload code

*** research dump(s)

*** HL7 backend

*** host script at funny paths

*** check "special note" XML works (later) (task + patient)

*** ?special device for "web front end"
*** ?special device for "manually uploaded"
    ... string constants; prevent devices from being registered with that name?

??? make main pages refer to CSS as a file; provide views to serve those CSS
    files; mark them as cacheable by the browser (but still need inline CSS
    for PDF creation!).

DOCUMENT merge warning:

    2017-08-25 22:27:23.234 cardinal_pythonlib.sqlalchemy.merge_db:INFO: Processing table 'blobs' via ORM class <class 'camcops_server.cc_modules.cc_blob.Blob'>
    /home/rudolf/dev/venvs/camcops/lib/python3.5/site-packages/sqlalchemy/engine/default.py:504: Warning: (1300, "Invalid utf8 character string: '89504E'")
      cursor.execute(statement, parameters)
    /home/rudolf/dev/venvs/camcops/lib/python3.5/site-packages/sqlalchemy/engine/default.py:504: Warning: (1300, "Invalid utf8 character string: 'FFD8FF'")
      cursor.execute(statement, parameters)

    ... or with database and SQLA-URL charset set to utf8mb4:

    2017-08-25 22:38:36.628 cardinal_pythonlib.sqlalchemy.merge_db:INFO: Processing table 'blobs' via ORM class <class 'camcops_server.cc_modules.cc_blob.Blob'>
    /home/rudolf/dev/venvs/camcops/lib/python3.5/site-packages/sqlalchemy/engine/default.py:504: Warning: (1300, "Invalid utf8mb4 character string: '89504E'")
      cursor.execute(statement, parameters)
    /home/rudolf/dev/venvs/camcops/lib/python3.5/site-packages/sqlalchemy/engine/default.py:504: Warning: (1300, "Invalid utf8mb4 character string: 'FFD8FF'")
      cursor.execute(statement, parameters)

    Potentially related:

        https://bitbucket.org/zzzeek/sqlalchemy/issues/3291/problem-using-binary-type-with-foreign-key
        https://bitbucket.org/zzzeek/sqlalchemy/issues/3804/invalid-utf8-character-string-warning-on
        https://github.com/PyMySQL/mysqlclient-python/issues/81
        https://github.com/PyMySQL/mysqlclient-python/pull/106

    ... so it's probably a driver issue

    YES; goes away using "pymysql" rather than "mysqldb", so e.g. use

        DB_URL = mysql+pymysql://username:password@127.0.0.1:3306/database?charset=utf8mb4


===============================================================================
CAMCOPS SERVER THINGS TO DO NOW
===============================================================================

- fix MAKE_PACKAGE.py and server scripts to be able to serve tablet source
  code that's not in the Python server package (now we've moved to venvs
  properly)

- sort out SQLAlchemy, field type, and get_summaries()
    - use mixins to inherit fields; see
    http://docs.sqlalchemy.org/en/latest/orm/extensions/declarative/mixins.html

===============================================================================
CAMCOPS SERVER THINGS TO DO
===============================================================================

- O'Brien group study template (when details available).

- Giant "all tasks in full" view (like a clinical text view but for
  researchers)?

  ... maybe abstract a common core of the CTV and tracker into some sort of
      "agglomeration" class, then subclass this again for a research multi-task
      view.

- Edit existing (finalized) task instances? Do this in a generic way, i.e.
  offer table with fieldname, comment, old value, new value; constrain to
  min/max or permitted values where applicable; at first "submit", show
  differences and ask for confirmation; audit changes. For BLOBs, allow
  option to upload file (or leave unchanged).

- shift to Arrow for dates/times? (With sqlalchemy-utils?)

- document that anonymisation for research exports is supported as a basic
  framework, but use CRATE if you want to do it properly.

- make more/all tasks downloadable, rather than in the giant strings file
    - strings
        - make a default isTaskCrippled() in BaseTask
    - other files
        - we don't want these in the same XML template
        - task JS, help HTML, any additional task-specific media
        - store in subdirectory of media path, like blobs
        - on the server side, point to one or more directories to scan
        - on the tablet, have an XFILE() function, keyed to the task

- index of tasks by patient ID, to speed up lookup on the tablet?
  Pros and cons to this.
  Maybe defer (on the server side) until SQL Alchemy properly considered.
  (In any case, the fields are indexed on the server; see Patient.)
  On the tablet side, may be worthwhile, though, as the number of tasks grows.
  Defer until we try Qt/C++.

===============================================================================
THOUGHTS/POTENTIAL THINGS TO DO
===============================================================================

- refine unit testing, i.e. more branch coverage, and use of real or dummy
  database-record instances in more cases
- see also Python modules for unit testing

- internationalization of web interface (framework done)

- MRI triggering on task side
    - e.g. tasks written in Javascript under Titanium on Windows (when
      available), or even on tablets (but better under Windows to eliminate
      network latency; see below)
    - projection via standard VGA/DVI/HDMI
    - tasks talk to TCP/IP server on (ideally) same machine
        http://docs.appcelerator.com/titanium/3.0/#!/api/Titanium.Network.Socket.TCP
    - server runs in e.g. Python with Twisted
    - server talks to MRI scanner (for pulse synchronization) and response
      devices via USB, serial, whatever
    - others' serial trigger devices/code
        https://cni.stanford.edu/wiki/MR_Hardware
        https://raw.githubusercontent.com/cni/widgets/master/python/startScan.py
        https://cni.stanford.edu/wiki/SaveTriggers.py

===============================================================================
CONSIDERED BUT NOT IMPLEMENTED
===============================================================================

- SFTP export.
  Not necessary, as one can mount an SFTP directory via NFS, then just export
  as a plain file.
    http://stackoverflow.com/questions/432385/sftp-in-python-platform-independent
    http://stackoverflow.com/questions/5195427/twisted-conch-filetransfer

- Option to pass set of patient identifying data to an external tool (e.g.
  user's custom Python) to generate a research ID, for the anonymisation step,
  e.g. hashing an NHS number using a secret method not known to CamCOPS.
  ... anonymisation is Somebody Else's Business; we have a separate tool for
      that.

- Filter on multiple patient IDs. Would only be relevant for researchers trying
  to take a subset of data.
  ... No current clear demand; therefore follow YAGNI principle.
      https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it


===============================================================================
Notes
===============================================================================

-------------------------------------------------------------------------------
Generator expressions v. list comprehensions
-------------------------------------------------------------------------------
LC in general faster; GE are used to save memory, not routinely.
- http://stackoverflow.com/questions/11964130/
